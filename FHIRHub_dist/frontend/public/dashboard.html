<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FHIRHub - Tableau de bord</title>
  <link rel="stylesheet" href="css/styles.css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f9fafb;
      color: #111827;
    }
    
    .dashboard-header {
      background: linear-gradient(90deg, #ef4444 0%, #f97316 100%);
      color: white;
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    .dashboard-title {
      margin: 0;
      font-size: 1.5rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      color: white;
    }
    
    .title-icon {
      margin-right: 0.5rem;
      color: white;
    }
    
    .user-info {
      display: flex;
      align-items: center;
    }
    
    .user-role {
      font-size: 0.875rem;
      opacity: 0.9;
    }
    
    .logout-button {
      background-color: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      padding: 0.5rem;
      border-radius: 0.25rem;
      margin-left: 1rem;
      cursor: pointer;
      font-size: 0.875rem;
      display: flex;
      align-items: center;
    }
    
    .logout-button:hover {
      background-color: rgba(255, 255, 255, 0.3);
    }
    
    .main-container {
      padding: 0;
      max-width: 100%;
      margin: 0 auto;
    }
    
    .nav-menu {
      margin: 0;
      background-color: #f9fafb;
      padding: 0;
      box-shadow: none;
      width: 100%;
      border-bottom: 1px solid #e5e7eb;
      border-radius: 0;
    }
    
    .nav-menu ul {
      list-style-type: none;
      padding: 0;
      margin: 0;
      display: flex;
      gap: 0;
      font-size: 0.9rem;
      border-radius: 0;
    }
    
    .nav-menu li {
      display: flex;
      align-items: center;
      cursor: pointer;
      padding: 1rem 1.5rem;
      border-bottom: 2px solid transparent;
      transition: all 0.2s ease;
      border-radius: 0;
    }
    
    .nav-menu li .material-icons-outlined {
      font-size: 1.25rem;
      margin-right: 0.5rem;
      color: #6b7280;
    }
    
    .nav-menu li:hover .material-icons-outlined,
    .nav-menu li:hover {
      color: #ef4444;
    }
    
    .nav-menu li.active {
      color: #ef4444;
      font-weight: 500;
      border-bottom: 2px solid #ef4444;
      background-color: white;
      border-radius: 0;
      margin: 0;
    }
    
    .nav-menu li.active .material-icons-outlined {
      color: #ef4444;
    }
    
    .dashboard-section {
      margin-bottom: 1.5rem;
      padding: 1rem 2rem;
    }
    
    .section-title {
      font-size: 1.25rem;
      font-weight: 600;
      margin-top: 0;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
    }
    
    .action-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    
    .stat-card {
      background-color: white;
      border-radius: 0.5rem;
      padding: 1rem;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    
    .stat-title {
      font-size: 0.875rem;
      color: #6b7280;
      margin-bottom: 0.5rem;
    }
    
    .stat-value {
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: #ef4444;
    }
    
    .stat-badge {
      display: inline-block;
      font-size: 0.75rem;
      color: #047857;
      background-color: #ecfdf5;
      padding: 0.25rem 0.5rem;
      border-radius: 0.25rem;
    }
    
    .system-stats {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    
    .system-stat-card {
      background-color: white;
      border-radius: 0.5rem;
      padding: 1rem;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    
    .system-stat-title {
      font-size: 0.875rem;
      color: #6b7280;
      margin-bottom: 0.5rem;
    }
    
    .system-stat-value {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 0.75rem;
      color: #ef4444;
    }
    
    .progress-container {
      width: 100%;
      height: 0.5rem;
      background-color: #e5e7eb;
      border-radius: 0.25rem;
      overflow: hidden;
    }
    
    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #ef4444 0%, #f97316 100%);
      border-radius: 0.25rem;
      transition: width 0.3s ease;
    }
    
    .charts-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 1.5rem;
      margin-bottom: 1.5rem;
    }
    
    .chart-card {
      background-color: white;
      border-radius: 0.5rem;
      padding: 1rem;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    
    .chart-title {
      font-size: 1rem;
      font-weight: 500;
      margin-top: 0;
      margin-bottom: 1rem;
      color: #374151;
    }
    
    .chart-container {
      height: 300px;
      position: relative;
    }
    
    .service-status {
      background-color: white;
      border-radius: 0.5rem;
      padding: 1rem;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    
    .status-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 0.75rem;
    }
    
    .service-status-item {
      display: flex;
      align-items: center;
      padding: 0.75rem;
      border-radius: 0.375rem;
      background-color: #f9fafb;
    }
    
    .status-indicator {
      width: 0.75rem;
      height: 0.75rem;
      border-radius: 50%;
      margin-right: 0.75rem;
    }
    
    .status-indicator-healthy {
      background-color: #10b981;
    }
    
    .status-indicator-warning {
      background-color: #f59e0b;
    }
    
    .status-indicator-error {
      background-color: #ef4444;
    }
    
    .service-name {
      font-size: 0.875rem;
      font-weight: 500;
      flex: 1;
      display: flex;
      align-items: center;
    }
    
    .service-name .material-icons-outlined {
      font-size: 1rem;
      margin-right: 0.5rem;
      color: #6b7280;
    }
    
    .service-detail {
      font-size: 0.75rem;
      color: #6b7280;
    }
    
    .action-button {
      background: linear-gradient(90deg, #ef4444 0%, #f97316 100%);
      border: none;
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 0.375rem;
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
    }
    
    .action-button .material-icons-outlined {
      font-size: 1rem;
      margin-right: 0.5rem;
    }
    
    .action-button:hover {
      background: linear-gradient(90deg, #dc2626 0%, #ea580c 100%);
    }
    
    .action-button-secondary {
      background-color: #f3f4f6;
      border: 1px solid #e5e7eb;
      color: #374151;
    }
    
    .action-button-secondary:hover {
      background-color: #e5e7eb;
    }
    
    .action-buttons {
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
    }
    
    @media (max-width: 768px) {
      .stats-grid,
      .system-stats,
      .charts-container {
        grid-template-columns: 1fr;
      }
      
      .nav-menu ul {
        flex-wrap: wrap;
      }
    }
  </style>
</head>
<body>
  <!-- En-tête du tableau de bord -->
  <header class="dashboard-header">
    <h1 class="dashboard-title">
      <span class="material-icons-outlined title-icon">local_fire_department</span>
      FHIRHub
    </h1>
    <div class="user-info">
      <div>
        <div class="user-role">Admin</div>
      </div>
      <button class="logout-button">
        <span class="material-icons-outlined">logout</span>
        Déconnexion
      </button>
    </div>
  </header>
  
  <!-- Contenu principal -->
  <div class="main-container">
    <!-- Menu de navigation -->
    <nav class="nav-menu">
      <ul>
        <li class="active">
          <span class="material-icons-outlined">dashboard</span>
          Tableau de bord
        </li>
        <li>
          <span class="material-icons-outlined">swap_horiz</span>
          Conversions
        </li>
        <li>
          <span class="material-icons-outlined">apps</span>
          Applications
        </li>
        <li>
          <span class="material-icons-outlined">vpn_key</span>
          Clés API
        </li>
        <li>
          <span class="material-icons-outlined">folder_open</span>
          Surveillance
        </li>
        <li>
          <span class="material-icons-outlined">description</span>
          Journaux
        </li>
        <li>
          <span class="material-icons-outlined">people</span>
          Utilisateurs
        </li>
        <li>
          <span class="material-icons-outlined">settings</span>
          Paramètres
        </li>
      </ul>
    </nav>
    
    <!-- Section principale du tableau de bord -->
    <section class="dashboard-section">
      <div class="action-bar">
        <h2 class="section-title">
          <span class="material-icons-outlined">insights</span>
          Tableau de bord
        </h2>
        
        <button class="action-button">
          <span class="material-icons-outlined">add</span>
          Nouvelle conversion
        </button>
      </div>
      
      <!-- Statistiques globales -->
      <h3 class="section-title">
        <span class="material-icons-outlined">bar_chart</span>
        Statistiques globales
      </h3>
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-title">Conversions totales</div>
          <div class="stat-value" id="total-conversions">4,812</div>
          <div class="stat-badge" id="today-conversions">+24 aujourd'hui</div>
        </div>
        <div class="stat-card">
          <div class="stat-title">Ressources FHIR générées</div>
          <div class="stat-value" id="total-resources">32,842</div>
          <div class="stat-badge" id="today-resources">+178 aujourd'hui</div>
        </div>
        <div class="stat-card">
          <div class="stat-title">Temps moyen de conversion</div>
          <div class="stat-value" id="avg-conversion-time">245ms</div>
          <div class="stat-badge">-5% vs hier</div>
        </div>
        <div class="stat-card">
          <div class="stat-title">Taux d'erreur</div>
          <div class="stat-value" id="error-rate">0.8%</div>
          <div class="stat-badge">-0.2% vs hier</div>
        </div>
      </div>
      
      <!-- Statistiques système -->
      <h3 class="section-title">
        <span class="material-icons-outlined">memory</span>
        Statistiques système
      </h3>
      <div class="system-stats">
        <div class="system-stat-card">
          <div class="system-stat-title">Utilisation CPU</div>
          <div class="system-stat-value" id="cpu-usage">12%</div>
          <div class="progress-container">
            <div class="progress-bar" id="cpu-bar" style="width: 12%"></div>
          </div>
        </div>
        <div class="system-stat-card">
          <div class="system-stat-title">Utilisation mémoire</div>
          <div class="system-stat-value" id="ram-usage">348 MB</div>
          <div class="progress-container">
            <div class="progress-bar" id="ram-bar" style="width: 4%"></div>
          </div>
        </div>
        <div class="system-stat-card">
          <div class="system-stat-title">Utilisation disque</div>
          <div class="system-stat-value" id="disk-usage">1.2 GB</div>
          <div class="progress-container">
            <div class="progress-bar" id="disk-bar" style="width: 8%"></div>
          </div>
        </div>
        <div class="system-stat-card">
          <div class="system-stat-title">Temps d'activité</div>
          <div class="system-stat-value" id="uptime">14d 6h</div>
          <div class="progress-container">
            <div class="progress-bar" style="width: 100%"></div>
          </div>
        </div>
      </div>
      
      <!-- Graphiques -->
      <h3 class="section-title">
        <span class="material-icons-outlined">analytics</span>
        Graphiques de performance
      </h3>
      <div class="charts-container">
        <div class="chart-card">
          <h4 class="chart-title">Performance système</h4>
          <div class="chart-container">
            <canvas id="system-performance-chart"></canvas>
          </div>
        </div>
        <div class="chart-card">
          <h4 class="chart-title">Conversions par jour</h4>
          <div class="chart-container">
            <canvas id="conversions-chart"></canvas>
          </div>
        </div>
      </div>
      
      <!-- Statut des services -->
      <h3 class="section-title">
        <span class="material-icons-outlined">dns</span>
        Statut des services
      </h3>
      <div class="service-status">
        <div class="status-list">
          <div class="service-status-item">
            <div class="status-indicator status-indicator-healthy"></div>
            <div class="service-name">
              <span class="material-icons-outlined">swap_horiz</span>
              Convertisseur HL7
            </div>
            <div class="service-detail">Actif - Charge: 6%</div>
          </div>
          <div class="service-status-item">
            <div class="status-indicator status-indicator-healthy"></div>
            <div class="service-name">
              <span class="material-icons-outlined">translate</span>
              Terminologies FR
            </div>
            <div class="service-detail">Actif - Cache: 95%</div>
          </div>
          <div class="service-status-item">
            <div class="status-indicator status-indicator-healthy"></div>
            <div class="service-name">
              <span class="material-icons-outlined">storage</span>
              Base de données
            </div>
            <div class="service-detail">Actif - Aucune erreur</div>
          </div>
          <div class="service-status-item">
            <div class="status-indicator status-indicator-healthy"></div>
            <div class="service-name">
              <span class="material-icons-outlined">http</span>
              API REST
            </div>
            <div class="service-detail">Actif - Dernière requête: 12s</div>
          </div>
          <div class="service-status-item">
            <div class="status-indicator status-indicator-healthy"></div>
            <div class="service-name">
              <span class="material-icons-outlined">public</span>
              Service web
            </div>
            <div class="service-detail">Actif - Port 5000</div>
          </div>
          <div class="service-status-item">
            <div class="status-indicator status-indicator-warning"></div>
            <div class="service-name">
              <span class="material-icons-outlined">folder_open</span>
              Surveillance fichiers
            </div>
            <div class="service-detail">Actif - 2 dossiers surveillés</div>
          </div>
        </div>
      </div>
      
      <!-- Actions système -->
      <h3 class="section-title">
        <span class="material-icons-outlined">build</span>
        Actions système
      </h3>
      <div class="action-buttons">
        <button class="action-button action-button-secondary" id="reset-counters">
          <span class="material-icons-outlined">restart_alt</span>
          Réinitialiser les compteurs
        </button>
        <button class="action-button action-button-secondary">
          <span class="material-icons-outlined">cleaning_services</span>
          Vider le cache
        </button>
        <button class="action-button action-button-secondary">
          <span class="material-icons-outlined">refresh</span>
          Redémarrer les services
        </button>
      </div>
    </section>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // Variables globales
    let systemPerformanceChart;
    let conversionsChart; 
    let cachedStats = null;

    // Au chargement de la page
    document.addEventListener('DOMContentLoaded', function() {
      console.log('Dashboard script loaded successfully');
      
      // Initialiser le tableau de bord
      initializeDashboard();
      
      // Configurer les gestionnaires d'événements
      setupEventListeners();
      
      // Mise à jour périodique des statistiques
      setInterval(function() {
        var stats = getUpdatedStats();
        updateDashboardUI(stats);
        updateCharts(stats);
      }, 10000); // Rafraîchir toutes les 10 secondes
    });

    /**
     * Initialise le tableau de bord et ses composants
     */
    function initializeDashboard() {
      var stats = getDefaultStats();
      updateDashboardUI(stats);
      initializeCharts(stats);
    }

    /**
     * Configure les gestionnaires d'événements
     */
    function setupEventListeners() {
      // Gestionnaire pour le bouton de réinitialisation des compteurs
      var resetButton = document.getElementById('reset-counters');
      if (resetButton) {
        resetButton.addEventListener('click', function() {
          var stats = getUpdatedStats();
          updateDashboardUI(stats);
          updateCharts(stats);
          alert('Les compteurs ont été réinitialisés avec succès');
        });
      }
      
      // Gestionnaire pour les éléments du menu
      var menuItems = document.querySelectorAll('.nav-menu li');
      if (menuItems) {
        menuItems.forEach(function(item) {
          item.addEventListener('click', function() {
            // Supprimer la classe active de tous les éléments
            menuItems.forEach(function(mi) {
              mi.classList.remove('active');
            });
            
            // Ajouter la classe active à l'élément cliqué
            this.classList.add('active');
            
            // Navigation vers les différentes pages
            var menuName = this.textContent.trim();
            
            switch(menuName) {
              case 'Tableau de bord':
                // Déjà sur la page du tableau de bord
                break;
              case 'Conversions':
                window.location.href = 'conversions.html';
                break;
              default:
                // Pour les autres pages non encore implémentées
                alert('Navigation vers "' + menuName + '" - Fonctionnalité en développement');
                break;
            }
          });
        });
      }
    }

    /**
     * Récupère les statistiques système initiales
     */
    function getDefaultStats() {
      return {
        conversions: {
          total: 4812,
          today: 24,
          history: [
            { date: '21/04', count: 18 },
            { date: '22/04', count: 22 },
            { date: '23/04', count: 26 },
            { date: '24/04', count: 20 },
            { date: '25/04', count: 24 },
            { date: '26/04', count: 28 },
            { date: '27/04', count: 24 }
          ]
        },
        resources: {
          total: 32842,
          today: 178
        },
        performance: {
          avgConversionTime: 245,
          errorRate: 0.8
        },
        system: {
          cpu: 12,
          ram: 348,
          ramTotal: 8192,
          disk: 1228,
          diskTotal: 15360,
          uptime: 20640, // 14 jours et 6 heures en minutes
          uptimeFormatted: '14d 6h',
          startTime: '2023-04-13T08:00:00Z'
        },
        services: {
          converter: { status: 'healthy', load: 6 },
          terminology: { status: 'healthy', cacheHitRate: 95 },
          database: { status: 'healthy', errorCount: 0 },
          api: { status: 'healthy', lastRequestTime: 12 },
          web: { status: 'healthy', port: 5000 },
          fileMonitor: { status: 'warning', dirCount: 2 }
        }
      };
    }

    /**
     * Met à jour les statistiques avec des valeurs simulées
     */
    function getUpdatedStats() {
      if (!cachedStats) {
        cachedStats = getDefaultStats();
      }
      
      // CPU entre 10% et 18%
      cachedStats.system.cpu = Math.floor(10 + Math.random() * 8);
      
      // RAM entre 320MB et 380MB
      cachedStats.system.ram = Math.floor(320 + Math.random() * 60);
      
      // Mise à jour des services
      cachedStats.services.converter.load = Math.floor(5 + Math.random() * 4); // 5-8%
      cachedStats.services.terminology.cacheHitRate = Math.floor(93 + Math.random() * 7); // 93-99%
      
      // Uptime qui augmente
      var uptimeMinutes = parseInt(cachedStats.system.uptime || 0, 10) + 1;
      var days = Math.floor(uptimeMinutes / (60 * 24));
      var hours = Math.floor((uptimeMinutes - (days * 60 * 24)) / 60);
      cachedStats.system.uptime = uptimeMinutes;
      cachedStats.system.uptimeFormatted = days + 'd ' + hours + 'h';
      
      return cachedStats;
    }

    /**
     * Met à jour l'interface utilisateur du dashboard avec les statistiques
     */
    function updateDashboardUI(stats) {
      // Fonction pour mettre à jour un élément en toute sécurité
      function safelyUpdateElement(id, value) {
        var element = document.getElementById(id);
        if (element) {
          element.textContent = value;
        }
      }
      
      // Fonction pour mettre à jour une barre de progression
      function safelyUpdateProgressBar(id, percentage) {
        var element = document.getElementById(id);
        if (element) {
          element.style.width = percentage + '%';
        }
      }
      
      // Mettre à jour les statistiques principales
      safelyUpdateElement('total-conversions', formatNumber(stats.conversions.total));
      safelyUpdateElement('today-conversions', '+' + stats.conversions.today + ' aujourd\'hui');
      safelyUpdateElement('total-resources', formatNumber(stats.resources.total));
      safelyUpdateElement('today-resources', '+' + stats.resources.today + ' aujourd\'hui');
      safelyUpdateElement('avg-conversion-time', stats.performance.avgConversionTime + 'ms');
      safelyUpdateElement('error-rate', stats.performance.errorRate + '%');
      
      // Mettre à jour les statistiques système
      safelyUpdateElement('cpu-usage', stats.system.cpu + '%');
      safelyUpdateProgressBar('cpu-bar', stats.system.cpu);
      
      safelyUpdateElement('ram-usage', stats.system.ram + ' MB');
      safelyUpdateProgressBar('ram-bar', Math.round(stats.system.ram / stats.system.ramTotal * 100));
      
      safelyUpdateElement('disk-usage', (stats.system.disk / 1024).toFixed(1) + ' GB');
      safelyUpdateProgressBar('disk-bar', Math.round(stats.system.disk / stats.system.diskTotal * 100));
      
      safelyUpdateElement('uptime', stats.system.uptimeFormatted);
      
      // Mise à jour du statut des services (simplifiée pour éviter les erreurs)
      updateServiceDetail('Convertisseur HL7', 'Actif - Charge: ' + stats.services.converter.load + '%');
      updateServiceDetail('Terminologies FR', 'Actif - Cache: ' + stats.services.terminology.cacheHitRate + '%');
    }
    
    /**
     * Met à jour le détail d'un service par son nom
     */
    function updateServiceDetail(serviceName, detail) {
      var items = document.querySelectorAll('.service-status-item');
      for (var i = 0; i < items.length; i++) {
        var nameElement = items[i].querySelector('.service-name');
        if (nameElement && nameElement.textContent.trim().includes(serviceName)) {
          var detailElement = items[i].querySelector('.service-detail');
          if (detailElement) {
            detailElement.textContent = detail;
          }
          break;
        }
      }
    }

    /**
     * Formate un nombre avec des séparateurs de milliers
     */
    function formatNumber(num) {
      return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    }

    /**
     * Initialise les graphiques du dashboard
     */
    function initializeCharts(stats) {
      try {
        // Graphique de performance système
        var systemCtx = document.getElementById('system-performance-chart');
        if (systemCtx) {
          // Dates pour les 7 derniers jours
          var dates = [];
          for (var i = 6; i >= 0; i--) {
            var date = new Date();
            date.setDate(date.getDate() - i);
            dates.push(date.toLocaleDateString('fr-FR', { day: '2-digit', month: '2-digit' }));
          }
          
          // Données simulées
          var cpuData = [5, 8, 12, 7, 10, 15, stats.system.cpu];
          var ramData = [320, 340, 380, 350, 325, 360, stats.system.ram];
          
          systemPerformanceChart = new Chart(systemCtx, {
            type: 'line',
            data: {
              labels: dates,
              datasets: [
                {
                  label: 'CPU (%)',
                  data: cpuData,
                  borderColor: '#ef4444',
                  backgroundColor: 'rgba(239, 68, 68, 0.1)',
                  tension: 0.3,
                  fill: true
                },
                {
                  label: 'RAM (MB)',
                  data: ramData,
                  borderColor: '#f97316',
                  backgroundColor: 'rgba(249, 115, 22, 0.1)',
                  tension: 0.3,
                  fill: true
                }
              ]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  position: 'top',
                }
              },
              scales: {
                y: {
                  beginAtZero: true
                }
              }
            }
          });
        }
        
        // Graphique de conversions par jour
        var conversionsCtx = document.getElementById('conversions-chart');
        if (conversionsCtx && stats.conversions.history) {
          // Utiliser les données d'historique
          var labels = stats.conversions.history.map(function(entry) { return entry.date; });
          var data = stats.conversions.history.map(function(entry) { return entry.count; });
          
          conversionsChart = new Chart(conversionsCtx, {
            type: 'bar',
            data: {
              labels: labels,
              datasets: [
                {
                  label: 'Conversions',
                  data: data,
                  backgroundColor: 'rgba(239, 68, 68, 0.8)',
                  borderColor: '#ef4444',
                  borderWidth: 1
                }
              ]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  position: 'top',
                }
              },
              scales: {
                y: {
                  beginAtZero: true
                }
              }
            }
          });
        }
      } catch (error) {
        console.log("Erreur lors de l'initialisation des graphiques:", error);
      }
    }

    /**
     * Met à jour les graphiques avec les nouvelles statistiques
     */
    function updateCharts(stats) {
      try {
        // Mise à jour du graphique de performance système
        if (systemPerformanceChart && 
            systemPerformanceChart.data && 
            systemPerformanceChart.data.datasets && 
            systemPerformanceChart.data.datasets.length >= 2) {
          
          var cpuData = systemPerformanceChart.data.datasets[0].data;
          var ramData = systemPerformanceChart.data.datasets[1].data;
          
          if (cpuData && cpuData.length > 0) {
            cpuData[cpuData.length - 1] = stats.system.cpu;
          }
          
          if (ramData && ramData.length > 0) {
            ramData[ramData.length - 1] = stats.system.ram;
          }
          
          systemPerformanceChart.update();
        }
      } catch (error) {
        console.log("Erreur lors de la mise à jour des graphiques:", error);
      }
    }
  </script>
</body>
</html>