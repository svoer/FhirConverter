<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Documentation - FHIRHub</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/styles.css">
  <link rel="stylesheet" href="/css/sidebar-menu.css">
  
  <!-- Inclusion du menu latéral -->
  <script src="/js/include-sidebar.js" defer></script>
  <script src="/js/sidebar-menu-new.js" defer></script>
  <style>
    .documentation-section {
      margin-bottom: 40px;
      padding: 20px;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .code-block {
      background-color: #272822;
      color: #f8f8f2;
      padding: 15px;
      border-radius: 4px;
      font-family: monospace;
      overflow-x: auto;
      margin: 15px 0;
    }
    
    .workflow-diagram {
      width: 100%;
      max-width: 800px;
      margin: 20px auto;
      display: block;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .section-nav {
      position: sticky;
      top: 0;
      z-index: 100;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      background-color: rgba(255, 255, 255, 0.95);
      padding: 10px 5px;
      margin-bottom: 30px;
      border-bottom: 1px solid #eee;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      backdrop-filter: blur(5px);
    }
    
    .section-nav a {
      display: inline-block;
      margin: 5px 10px;
      color: #555;
      text-decoration: none;
      padding: 8px 12px;
      font-weight: 500;
      border-radius: 20px;
      transition: all 0.2s ease;
      font-size: 0.9em;
      background-color: #f9f9f9;
    }
    
    .section-nav a:hover {
      background-color: #f1f1f1;
      color: #ff5722;
    }
    
    .section-nav a:hover, .section-nav a.active {
      color: #e74c3c;
      border-bottom-color: #e74c3c;
    }
    
    .workflow-step {
      display: flex;
      margin-bottom: 15px;
      padding: 15px;
      background-color: #f8f9fa;
      border-radius: 8px;
      border-left: 4px solid #3498db;
    }
    
    .step-number {
      flex: 0 0 30px;
      height: 30px;
      border-radius: 50%;
      background-color: #3498db;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      margin-right: 15px;
    }
    
    .step-content {
      flex: 1;
    }
    
    .step-title {
      font-weight: 600;
      margin-bottom: 5px;
    }
    
    .step-description {
      color: #555;
      line-height: 1.5;
    }
    
    .terminology-mapping {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }
    
    .terminology-mapping th {
      text-align: left;
      padding: 10px;
      background-color: #f1f1f1;
      border-bottom: 2px solid #ddd;
    }
    
    .terminology-mapping td {
      padding: 10px;
      border-bottom: 1px solid #ddd;
    }
    
    .terminology-mapping tr:hover {
      background-color: #f9f9f9;
    }
    
    .back-to-top {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 40px;
      height: 40px;
      background-color: #e74c3c;
      color: white;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      text-decoration: none;
      opacity: 0;
      transition: opacity 0.3s;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      z-index: 1000;
    }
    
    .back-to-top.visible {
      opacity: 1;
    }
    
    .warning-box {
      background-color: #fff3cd;
      border-left: 4px solid #ffc107;
      padding: 15px;
      margin: 15px 0;
      border-radius: 4px;
    }
    
    .info-box {
      background-color: #d1ecf1;
      border-left: 4px solid #17a2b8;
      padding: 15px;
      margin: 15px 0;
      border-radius: 4px;
    }
    
    .tip-box {
      background-color: #d4edda;
      border-left: 4px solid #28a745;
      padding: 15px;
      margin: 15px 0;
      border-radius: 4px;
    }
    
    .tech-spec {
      background-color: #f8f9fa;
      padding: 15px;
      margin: 15px 0;
      border-radius: 4px;
      border: 1px solid #dee2e6;
    }
    
    .tech-spec-title {
      font-weight: 600;
      margin-bottom: 10px;
      color: #495057;
    }
  </style>
</head>
<body>
  <!-- Le menu latéral sera chargé par include-sidebar.js -->
  <div id="sidebar-container"></div>

  <div class="main-content">
    <div class="container">
      <h1>Documentation Technique FHIRHub</h1>
      
      <div class="section-nav">
        <a href="#introduction" class="active">Introduction</a>
        <a href="#parser">Analyse HL7</a>
        <a href="#message-types">Types de Messages</a>
        <a href="#converter">Convertisseur</a>
        <a href="#terminology">Nomenclatures et Terminologies</a>
        <a href="#workflows">Workflows</a>
        <a href="#ai-integration">IA & Assistance</a>
        <a href="#api">APIs</a>
        <a href="#cache">Système de Cache</a>
        <a href="#database">Base de Données</a>
        <a href="#docker">Déploiement Docker</a>
        <a href="#prerequites">Prérequis</a>
      </div>
      
      <div id="introduction" class="documentation-section">
        <h2>Introduction à FHIRHub</h2>
        <p>FHIRHub est une solution robuste de conversion de messages HL7 v2.5 vers le format FHIR R4, conçue spécifiquement pour l'écosystème de santé français. Cette documentation explique les mécanismes internes du système et comment l'utiliser efficacement.</p>
        
        <div class="tip-box">
          <p><strong>Le futur du partage de données santé, dès aujourd'hui.</strong> Modernisez votre interop, sans refonte, sans complexité. FHIRHub – L'upgrade FHIR, aussi simple qu'un glisser-déposer.</p>
        </div>
        
        <h3>Architecture générale</h3>
        <p>FHIRHub est conçu avec une architecture API-first qui permet son intégration dans n'importe quel environnement de santé. Le système se compose de plusieurs modules interconnectés :</p>
        
        <div class="workflow-step">
          <div class="step-number">1</div>
          <div class="step-content">
            <div class="step-title">Parser HL7</div>
            <div class="step-description">Module d'analyse syntaxique des messages HL7 v2.5 qui extrait et structure chaque composant.</div>
          </div>
        </div>
        
        <div class="workflow-step">
          <div class="step-number">2</div>
          <div class="step-content">
            <div class="step-title">Service de Terminologie</div>
            <div class="step-description">Gestion des mappings entre les codes HL7 et les terminologies françaises (ANS).</div>
          </div>
        </div>
        
        <div class="workflow-step">
          <div class="step-number">3</div>
          <div class="step-content">
            <div class="step-title">Convertisseur FHIR</div>
            <div class="step-description">Transformation des données structurées en ressources FHIR R4 complètes.</div>
          </div>
        </div>
        
        <div class="workflow-step">
          <div class="step-number">4</div>
          <div class="step-content">
            <div class="step-title">API RESTful</div>
            <div class="step-description">Endpoints pour l'intégration dans des systèmes existants, avec authentification sécurisée.</div>
          </div>
        </div>
        
        <div class="tech-spec">
          <div class="tech-spec-title">Spécifications techniques</div>
          <ul>
            <li><strong>Backend :</strong> Node.js avec Express.js</li>
            <li><strong>Base de données :</strong> SQLite pour la portabilité</li>
            <li><strong>Frontend :</strong> Interface moderne basée sur HTML5, CSS3 et JavaScript</li>
            <li><strong>Format cible :</strong> FHIR R4 (v4.0.1) conforme aux spécifications ANS</li>
            <li><strong>Sécurité :</strong> JWT + clés API + HTTPS</li>
          </ul>
        </div>
      </div>
      
      <div id="parser" class="documentation-section">
        <h2>Fonctionnement du Parser HL7</h2>
        <p>Le parser HL7 est le composant qui analyse les messages HL7 v2.5 et les transforme en structure de données exploitable. Il s'agit d'une implémentation optimisée qui extrait la hiérarchie complète des données HL7.</p>
        
        <h3>Processus d'analyse</h3>
        <p>Le parser fonctionne en plusieurs phases :</p>
        
        <div class="workflow-step">
          <div class="step-number">1</div>
          <div class="step-content">
            <div class="step-title">Identification des séparateurs</div>
            <div class="step-description">Le parser détecte automatiquement les séparateurs utilisés dans le message (champ, composant, répétition, échappement) à partir de l'en-tête MSH.</div>
          </div>
        </div>
        
        <div class="workflow-step">
          <div class="step-number">2</div>
          <div class="step-content">
            <div class="step-title">Découpage en segments</div>
            <div class="step-description">Le message est divisé en segments (lignes) identifiés par leur code de 3 caractères (MSH, PID, PV1, etc.).</div>
          </div>
        </div>
        
        <div class="workflow-step">
          <div class="step-number">3</div>
          <div class="step-content">
            <div class="step-title">Analyse des champs</div>
            <div class="step-description">Chaque segment est divisé en champs selon le séparateur principal (généralement |).</div>
          </div>
        </div>
        
        <div class="workflow-step">
          <div class="step-number">4</div>
          <div class="step-content">
            <div class="step-title">Décomposition hiérarchique</div>
            <div class="step-description">Les champs complexes sont décomposés en composants, sous-composants et répétitions selon les séparateurs secondaires (^, &, ~).</div>
          </div>
        </div>
        
        <div class="workflow-step">
          <div class="step-number">5</div>
          <div class="step-content">
            <div class="step-title">Construction de l'arbre de données</div>
            <div class="step-description">Une structure de données hiérarchique est générée, permettant l'accès aux éléments via des chemins logiques.</div>
          </div>
        </div>
        
        <h3>Exemple de code du parser</h3>
        <pre class="code-block">/**
 * Parse un message HL7 et extrait tous les segments et champs
 * @param {string} hl7Message - Message HL7 au format texte
 * @returns {Object} Structure contenant tous les segments et leurs champs
 */
function parseHL7Message(hl7Message) {
  // Nettoyer le message (retirer les caractères de contrôle)
  const cleanedMessage = hl7Message.replace(/\r/g, '\n').replace(/\n+/g, '\n');
  
  // Découper en segments
  const segments = cleanedMessage.split('\n').filter(line => line.trim().length > 0);
  
  // Résultat
  const parsedMessage = {};
  
  // Extraire les séparateurs à partir du segment MSH
  const fieldSeparator = segments[0].charAt(3) || '|';
  const componentSeparator = segments[0].charAt(4) || '^';
  const repetitionSeparator = segments[0].charAt(5) || '~';
  const escapeChar = segments[0].charAt(6) || '\\';
  const subcomponentSeparator = segments[0].charAt(7) || '&';
  
  // Parcourir tous les segments
  segments.forEach(segment => {
    // Récupérer le type de segment (MSH, PID, etc.)
    const segmentType = segment.substring(0, 3);
    
    // Découper le segment en champs
    const fields = segment.split(fieldSeparator);
    
    // Cas spécial pour MSH (le séparateur est considéré comme le champ 2)
    if (segmentType === 'MSH') {
      fields[1] = fieldSeparator;
    }
    
    // Traiter chaque champ pour extraire les composants
    const parsedFields = fields.map(field => 
      parseComponent(field, componentSeparator, subcomponentSeparator, repetitionSeparator)
    );
    
    // Ajouter le segment au résultat
    if (!parsedMessage[segmentType]) {
      parsedMessage[segmentType] = [];
    }
    parsedMessage[segmentType].push(parsedFields);
  });
  
  return parsedMessage;
}</pre>
        
        <h3>Optimisations spécifiques</h3>
        <p>Notre parser intègre plusieurs optimisations pour gérer les spécificités françaises :</p>
        <ul>
          <li><strong>Détection intelligente des prénoms composés</strong> dans les champs PID-5, conformément aux recommandations de l'ANS.</li>
          <li><strong>Support des accents et caractères spéciaux</strong> fréquents dans les noms français (é, è, ê, à, ç, etc.).</li>
          <li><strong>Gestion des exceptions</strong> pour les structures non-standard parfois rencontrées dans les SIH français.</li>
          <li><strong>Analyse contextuelle</strong> pour déterminer le bon type d'identifiant (IPP, INS, INS-C) selon les OIDs français.</li>
        </ul>
      </div>
      
      <div id="message-types" class="documentation-section">
        <h2>Types de Messages HL7 supportés</h2>
        <p>FHIRHub est conçu pour prendre en charge différents types de messages HL7, avec une prise en charge complète des messages ADT et une extension progressive vers d'autres types.</p>
        
        <h3>Documentation détaillée par type de message</h3>
        <p>Une documentation technique détaillée est disponible pour chaque type de message, accessible dans le dossier <code>docs/message_types</code> du projet :</p>
        
        <div class="tech-spec">
          <div class="tech-spec-title">Types de messages documentés</div>
          <table class="terminology-mapping">
            <thead>
              <tr>
                <th>Type</th>
                <th>Description</th>
                <th>Statut</th>
                <th>Documentation</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>ADT</strong></td>
                <td>Admission, Discharge, Transfer</td>
                <td><span style="color: #28a745;">Implémenté</span></td>
                <td><a href="/docs/message_types/ADT" target="_blank">Documentation ADT</a></td>
              </tr>
              <tr>
                <td><strong>ORU</strong></td>
                <td>Observation Results Unsolicited</td>
                <td><span style="color: #ffc107;">Documentation</span></td>
                <td>
                  <a href="/docs/message_types/ORU" target="_blank">README</a> | 
                  <a href="/docs/message_types/ORU/MAPPING" target="_blank">Mapping</a> | 
                  <a href="/docs/message_types/ORU/REQUIREMENTS" target="_blank">Requirements</a>
                </td>
              </tr>
              <tr>
                <td><strong>SIU</strong></td>
                <td>Scheduling Information Unsolicited</td>
                <td><span style="color: #ffc107;">Documentation</span></td>
                <td><a href="/docs/message_types/SIU" target="_blank">Documentation SIU</a></td>
              </tr>
              <tr>
                <td><strong>MDM</strong></td>
                <td>Medical Document Management</td>
                <td><span style="color: #ffc107;">Documentation</span></td>
                <td><a href="/docs/message_types/MDM" target="_blank">Documentation MDM</a></td>
              </tr>
              <tr>
                <td><strong>ORM</strong></td>
                <td>Order Message</td>
                <td><span style="color: #ffc107;">Documentation</span></td>
                <td><a href="/docs/message_types/ORM" target="_blank">Documentation ORM</a></td>
              </tr>
            </tbody>
          </table>
        </div>
        
        <div class="info-box">
          <p><strong>Comment contribuer :</strong> Pour ajouter la prise en charge d'un nouveau type de message, consultez la documentation dans le dossier correspondant. Chaque dossier contient des informations détaillées sur les mappings entre les segments HL7 et les ressources FHIR, ainsi que les exigences pour l'implémentation.</p>
        </div>
      </div>
      
      <div id="converter" class="documentation-section">
        <h2>Convertisseur HL7 vers FHIR</h2>
        <p>Le convertisseur prend les données structurées par le parser HL7 et les transforme en ressources FHIR R4 conformes aux spécifications françaises.</p>
        
        <h3>Principes de conversion</h3>
        <p>La conversion suit plusieurs principes fondamentaux :</p>
        <ul>
          <li><strong>Conservation complète de l'information</strong> : aucune donnée n'est perdue pendant la conversion.</li>
          <li><strong>Conformité stricte</strong> aux profils FHIR français de l'ANS.</li>
          <li><strong>Traçabilité</strong> : chaque élément FHIR peut être relié à son origine dans le message HL7.</li>
          <li><strong>Enrichissement contextuel</strong> : ajout d'informations déduites du contexte pour améliorer l'interopérabilité.</li>
        </ul>
        
        <h3>Processus de conversion</h3>
        
        <div class="workflow-step">
          <div class="step-number">1</div>
          <div class="step-content">
            <div class="step-title">Identification du type de message</div>
            <div class="step-description">Détermination du type d'événement (ADT, ORU, SIU, etc.) pour adapter le processus de conversion.</div>
          </div>
        </div>
        
        <div class="workflow-step">
          <div class="step-number">2</div>
          <div class="step-content">
            <div class="step-title">Extraction des entités principales</div>
            <div class="step-description">Création des ressources primaires comme Patient, Encounter, Organization à partir des segments PID, PV1, MSH.</div>
          </div>
        </div>
        
        <div class="workflow-step">
          <div class="step-number">3</div>
          <div class="step-content">
            <div class="step-title">Mappage des terminologies</div>
            <div class="step-description">Conversion des codes HL7 en codes FHIR à l'aide des terminologies françaises de l'ANS.</div>
          </div>
        </div>
        
        <div class="workflow-step">
          <div class="step-number">4</div>
          <div class="step-content">
            <div class="step-title">Établissement des relations</div>
            <div class="step-description">Création des références entre ressources pour maintenir la cohérence du modèle.</div>
          </div>
        </div>
        
        <div class="workflow-step">
          <div class="step-number">5</div>
          <div class="step-content">
            <div class="step-title">Construction du Bundle transaction</div>
            <div class="step-description">Assemblage de toutes les ressources dans un Bundle FHIR de type transaction.</div>
          </div>
        </div>
        
        <h3>Adaptations spécifiques pour la France</h3>
        <div class="info-box">
          <p>Le convertisseur intègre de nombreuses adaptations spécifiquement françaises :</p>
          <ul>
            <li>Structure des identifiants INS/INS-C avec les bons OIDs (1.2.250.1.213.1.4.8 et 1.2.250.1.213.1.4.2)</li>
            <li>Gestion intelligente des établissements de santé avec les identifiants FINESS</li>
            <li>Intégration des nomenclatures françaises pour les professions, spécialités et modes de prise en charge</li>
            <li>Support de l'extension encounter-expectedExitDate pour les dates de sortie prévue</li>
            <li>Structuration des adresses selon le format postal français (code postal à 5 chiffres, etc.)</li>
          </ul>
        </div>
        
        <h3>Exemple de transformation</h3>
        <p>Voici un exemple simplifié de conversion d'un segment PID vers une ressource Patient FHIR :</p>
        
        <div class="tech-spec">
          <div class="tech-spec-title">HL7 v2.5 Original</div>
          <pre>PID|1||458722781^^^CENTRE_HOSPITALIER_DE_TEST^PI||SECLET^MARYSE BERTHE ALICE||19830711|F</pre>
        </div>
        
        <div class="tech-spec">
          <div class="tech-spec-title">FHIR R4 Converti</div>
          <pre>{
  "resourceType": "Patient",
  "id": "patient-458722781",
  "identifier": [
    {
      "value": "458722781",
      "system": "urn:oid:1.2.250.1.71.4.2.7",
      "type": {
        "coding": [
          {
            "system": "http://terminology.hl7.org/CodeSystem/v2-0203",
            "code": "PI",
            "display": "Identifiant patient interne"
          }
        ]
      },
      "assigner": { "display": "CENTRE_HOSPITALIER_DE_TEST" }
    }
  ],
  "name": [
    {
      "use": "official",
      "family": "SECLET",
      "given": ["MARYSE", "BERTHE", "ALICE"]
    }
  ],
  "gender": "female",
  "birthDate": "1983-07-11"
}</pre>
        </div>
      </div>
      
      <div id="terminology" class="documentation-section">
        <h2>Gestion des Nomenclatures et Terminologies</h2>
        <p>FHIRHub intègre un service de terminologie spécialisé pour les systèmes de codification français, basé sur les référentiels de l'ANS (Agence du Numérique en Santé).</p>
        
        <h3>Service de Terminologie Française</h3>
        <p>Le service maintient une table de correspondance entre les codes HL7 et les URLs de systèmes FHIR, avec une attention particulière aux terminologies françaises.</p>
        
        <table class="terminology-mapping">
          <thead>
            <tr>
              <th>Type de code</th>
              <th>URL du système FHIR</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>PAYS</td>
              <td>https://mos.esante.gouv.fr/NOS/TRE_R20-Pays/FHIR/TRE-R20-Pays</td>
              <td>Codes des pays selon la nomenclature française</td>
            </tr>
            <tr>
              <td>GENDER</td>
              <td>https://mos.esante.gouv.fr/NOS/TRE_R303-HL7v3AdministrativeGender/FHIR/TRE-R303-HL7v3AdministrativeGender</td>
              <td>Codes de genre administratif</td>
            </tr>
            <tr>
              <td>ENCOUNTER_TYPE</td>
              <td>https://mos.esante.gouv.fr/NOS/TRE_R305-TypeRencontre/FHIR/TRE-R305-TypeRencontre</td>
              <td>Types de rencontre médicale</td>
            </tr>
            <tr>
              <td>PROFESSION</td>
              <td>https://mos.esante.gouv.fr/NOS/TRE_G15-ProfessionSante/FHIR/TRE-G15-ProfessionSante</td>
              <td>Professions de santé</td>
            </tr>
            <tr>
              <td>SPECIALITE</td>
              <td>https://mos.esante.gouv.fr/NOS/TRE_R38-SpecialiteOrdinale/FHIR/TRE-R38-SpecialiteOrdinale</td>
              <td>Spécialités médicales ordinales</td>
            </tr>
          </tbody>
        </table>
        
        <h3>OIDs français</h3>
        <p>Le système gère également les OIDs (Object Identifiers) spécifiques au système de santé français :</p>
        
        <table class="terminology-mapping">
          <thead>
            <tr>
              <th>Type d'identifiant</th>
              <th>OID</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>INS</td>
              <td>1.2.250.1.213.1.4.8</td>
              <td>Identifiant National de Santé (sécurisé)</td>
            </tr>
            <tr>
              <td>INS-C</td>
              <td>1.2.250.1.213.1.4.2</td>
              <td>Identifiant National de Santé (calculé)</td>
            </tr>
            <tr>
              <td>RPPS</td>
              <td>1.2.250.1.71.4.2.1</td>
              <td>Répertoire Partagé des Professionnels de Santé</td>
            </tr>
            <tr>
              <td>ADELI</td>
              <td>1.2.250.1.71.4.2.1</td>
              <td>Automatisation Des Listes (professions de santé)</td>
            </tr>
            <tr>
              <td>FINESS</td>
              <td>1.2.250.1.71.4.2.2</td>
              <td>Fichier National des Établissements Sanitaires et Sociaux</td>
            </tr>
            <tr>
              <td>IPP</td>
              <td>1.2.250.1.71.4.2.7</td>
              <td>Identifiant Permanent du Patient</td>
            </tr>
          </tbody>
        </table>
        
        <h3>Fonctionnement hors-ligne et mise à jour</h3>
        <p>FHIRHub est conçu pour fonctionner entièrement hors-ligne avec des terminologies préchargées. Ces terminologies peuvent être mises à jour via les fonctionnalités d'administration lorsqu'une connexion Internet est disponible.</p>
        
        <div class="warning-box">
          <p><strong>Note importante :</strong> Par défaut, FHIRHub inclut les terminologies françaises les plus récentes publiées par l'ANS. Assurez-vous de maintenir ces terminologies à jour pour garantir la conformité avec les dernières exigences réglementaires.</p>
        </div>

        <h3>Interface de gestion des nomenclatures</h3>
        <p>L'application dispose d'une <a href="/terminologies.html">interface de gestion des nomenclatures</a> qui permet de :</p>
        <ul>
          <li>Importer des fichiers JSON contenant des terminologies depuis l'API ANS</li>
          <li>Prévisualiser et vérifier le contenu des fichiers de terminologie</li>
          <li>Gérer les descriptions et mettre à jour les fichiers existants</li>
          <li>Exporter l'ensemble des terminologies pour sauvegarde ou migration</li>
          <li>Visualiser des statistiques sur les nomenclatures chargées</li>
        </ul>
        
        <p>Cette interface est accessible uniquement aux administrateurs et permet une gestion centralisée des terminologies françaises utilisées lors de la conversion des messages HL7 vers FHIR.</p>
      </div>
      
      <div id="workflows" class="documentation-section">
        <h2>Système de Workflows</h2>
        <p>FHIRHub intègre un système de workflows visuels permettant de créer des processus personnalisés pour le traitement des messages HL7 et des ressources FHIR, adapté à chaque application.</p>
        
        <h3>Présentation de l'éditeur de workflow</h3>
        <p>L'éditeur de workflow est un outil visuel intégré qui permet de créer des flux de traitement complexes sans écrire de code. Il offre une interface intuitive avec des nœuds interconnectables représentant différentes actions et conditions.</p>
        
        <div class="workflow-step">
          <div class="step-number">1</div>
          <div class="step-content">
            <div class="step-title">Éditeur visuel intuitif</div>
            <div class="step-description">Interface en glisser-déposer pour créer et connecter des nœuds sur une grille, avec redimensionnement des éléments à la souris.</div>
          </div>
        </div>
        
        <div class="workflow-step">
          <div class="step-number">2</div>
          <div class="step-content">
            <div class="step-title">Nœuds spécialisés</div>
            <div class="step-description">Une bibliothèque de nœuds personnalisés pour l'analyse HL7, la conversion FHIR, les notifications, les transformations de données, etc.</div>
          </div>
        </div>
        
        <div class="workflow-step">
          <div class="step-number">3</div>
          <div class="step-content">
            <div class="step-title">Configuration par application</div>
            <div class="step-description">Possibilité de créer des workflows distincts pour chaque application enregistrée dans FHIRHub.</div>
          </div>
        </div>
        
        <h3>Types de nœuds disponibles</h3>
        <p>Le système de workflows propose plusieurs catégories de nœuds pour construire des processus complets :</p>
        
        <div class="tech-spec">
          <div class="tech-spec-title">Catégories de nœuds</div>
          <ul>
            <li><strong>Entrées/Sorties :</strong> Réception de messages HL7, envoi de ressources FHIR, génération de fichiers, etc.</li>
            <li><strong>Transformation :</strong> Conversion HL7 vers FHIR, filtrage de données, agrégation, etc.</li>
            <li><strong>Logique :</strong> Conditions, branches, jonctions, boucles, etc.</li>
            <li><strong>Intégration :</strong> Appels API REST, messagerie, notifications, etc.</li>
            <li><strong>Analyse :</strong> Validation de messages, extraction de métriques, journalisation, etc.</li>
          </ul>
        </div>
        
        <h3>Configuration et déploiement</h3>
        <p>Les workflows sont sauvegardés dans la base de données et associés à une application spécifique. Lorsqu'un message est reçu via l'API de cette application, le workflow correspondant est automatiquement exécuté pour traiter le message selon les règles définies.</p>
        
        <div class="info-box">
          <p><strong>Note :</strong> Pour accéder à l'éditeur de workflow, cliquez sur "Workflows" dans le menu principal, puis sélectionnez l'application pour laquelle vous souhaitez créer ou modifier un workflow.</p>
        </div>
      </div>
      
      <div id="ai-integration" class="documentation-section">
        <h2>IA & Assistance intelligente</h2>
        <p>FHIRHub intègre des fonctionnalités d'intelligence artificielle pour faciliter l'utilisation du système et aider à résoudre les problèmes.</p>
        
        <h3>Chatbot de support</h3>
        <p>Un chatbot intelligent est disponible sur le tableau de bord pour répondre aux questions sur l'utilisation de FHIRHub, la conversion HL7-FHIR et les problèmes courants. Ce chatbot utilise les modèles d'IA configurés dans les paramètres et n'accède jamais aux données de santé réelles.</p>
        
        <div class="workflow-step">
          <div class="step-number">1</div>
          <div class="step-content">
            <div class="step-title">Assistance contextuelle</div>
            <div class="step-description">Le chatbot comprend le contexte de votre demande et peut fournir des explications spécifiques sur les fonctionnalités de FHIRHub.</div>
          </div>
        </div>
        
        <div class="workflow-step">
          <div class="step-number">2</div>
          <div class="step-content">
            <div class="step-title">Documentation intelligente</div>
            <div class="step-description">Accès à toute la documentation technique à travers une interface conversationnelle simple.</div>
          </div>
        </div>
        
        <div class="workflow-step">
          <div class="step-number">3</div>
          <div class="step-content">
            <div class="step-title">Diagnostic assisté</div>
            <div class="step-description">Aide à identifier et résoudre les problèmes de conversion ou de configuration.</div>
          </div>
        </div>
        
        <h3>Configuration des fournisseurs d'IA</h3>
        <p>FHIRHub prend en charge plusieurs fournisseurs d'IA pour alimenter ses fonctionnalités d'assistance :</p>
        
        <div class="tech-spec">
          <div class="tech-spec-title">Fournisseurs d'IA pris en charge</div>
          <ul>
            <li><strong>Mistral AI :</strong> Service d'IA français avec des modèles performants et compatibles RGPD</li>
            <li><strong>Google AI :</strong> Services d'IA de Google Cloud (nécessite une clé API)</li>
            <li><strong>DeepSeek :</strong> Modèles avancés pour le traitement du langage</li>
            <li><strong>Ollama :</strong> Modèles locaux (installation locale requise, idéal pour les environnements isolés)</li>
          </ul>
        </div>
        
        <div class="warning-box">
          <p><strong>Important :</strong> Les fonctionnalités d'IA ne traitent jamais directement les données de santé issues des messages HL7 ou des ressources FHIR. Elles sont utilisées uniquement pour l'assistance et la documentation.</p>
        </div>
        
        <h3>Paramétrage de l'IA</h3>
        <p>Les administrateurs peuvent configurer les services d'IA dans la section "Paramètres IA" accessible depuis le menu principal. Cette configuration inclut :</p>
        <ul>
          <li>Sélection du fournisseur d'IA préféré</li>
          <li>Gestion des clés API (stockées de manière sécurisée dans la base de données)</li>
          <li>Configuration des paramètres de modèle (température, longueur maximale, etc.)</li>
          <li>Options de confidentialité et restrictions d'accès</li>
        </ul>
      </div>
      
      <div id="api" class="documentation-section">
        <h2>APIs disponibles</h2>
        <p>FHIRHub expose plusieurs API RESTful pour permettre l'intégration et l'automatisation. Cette documentation complète liste toutes les APIs disponibles dans le système, groupées par catégorie.</p>
        
        <p>Une documentation interactive de l'API est disponible à l'adresse <a href="/api-docs" target="_blank">/api-docs</a> (Swagger UI). Pour tester les API, utilisez le bouton vert ⚡ Autoriser avec clé de test: dev-key.</p>
        
        <div class="tech-spec">
          <div class="tech-spec-title">API d'Authentification</div>
          <ul>
            <li><strong>POST /api/login</strong> - Authentification des utilisateurs</li>
            <li><strong>POST /api/logout</strong> - Déconnexion des utilisateurs</li>
            <li><strong>GET /api/user</strong> - Récupération des informations de l'utilisateur connecté</li>
          </ul>
        </div>
        
        <div class="tech-spec">
          <div class="tech-spec-title">API de Conversion</div>
          <ul>
            <li><strong>POST /api/convert</strong> - Convertit un message HL7 v2.5 en FHIR R4</li>
            <li><strong>POST /api/convert/validate</strong> - Valide la syntaxe d'un message HL7 v2.5</li>
          </ul>
        </div>
        
        <div class="tech-spec">
          <div class="tech-spec-title">API de Terminologie</div>
          <ul>
            <li><strong>GET /api/terminology/french</strong> - Obtient les informations sur les terminologies françaises</li>
            <li><strong>GET /api/terminology/files</strong> - Liste les fichiers de terminologie disponibles</li>
            <li><strong>POST /api/terminology/refresh</strong> - Rafraîchit les statistiques des terminologies</li>
            <li><strong>POST /api/terminology/analyze</strong> - Analyse le contenu des fichiers de terminologie</li>
            <li><strong>GET /api/terminology/check-duplicates</strong> - Vérifie les doublons dans les fichiers de terminologie</li>
            <li><strong>POST /api/terminology/remove-duplicates</strong> - Supprime les fichiers de terminologie en doublon</li>
            <li><strong>POST /api/terminology/import</strong> - Importe un nouveau fichier de terminologie</li>
            <li><strong>GET /api/terminology/files/:filename</strong> - Récupère un fichier de terminologie spécifique</li>
            <li><strong>DELETE /api/terminology/files/:filename</strong> - Supprime un fichier de terminologie</li>
            <li><strong>POST /api/terminology/export</strong> - Exporte tous les fichiers de terminologie en ZIP</li>
          </ul>
        </div>
        
        <div class="tech-spec">
          <div class="tech-spec-title">API d'Administration</div>
          <ul>
            <li><strong>GET /api/applications</strong> - Liste toutes les applications enregistrées</li>
            <li><strong>POST /api/applications</strong> - Crée une nouvelle application</li>
            <li><strong>GET /api/applications/:id</strong> - Récupère les détails d'une application</li>
            <li><strong>PUT /api/applications/:id</strong> - Met à jour une application</li>
            <li><strong>DELETE /api/applications/:id</strong> - Supprime une application</li>
          </ul>
        </div>
        
        <div class="tech-spec">
          <div class="tech-spec-title">API de Gestion des Clés API</div>
          <ul>
            <li><strong>GET /api/api-keys</strong> - Liste toutes les clés API</li>
            <li><strong>POST /api/api-keys</strong> - Crée une nouvelle clé API</li>
            <li><strong>GET /api/api-keys/:id</strong> - Récupère les détails d'une clé API</li>
            <li><strong>PUT /api/api-keys/:id</strong> - Met à jour une clé API (active/inactive)</li>
            <li><strong>DELETE /api/api-keys/:id</strong> - Supprime une clé API</li>
          </ul>
        </div>
        
        <div class="tech-spec">
          <div class="tech-spec-title">API de Gestion des Utilisateurs</div>
          <ul>
            <li><strong>GET /api/users</strong> - Liste tous les utilisateurs</li>
            <li><strong>POST /api/users</strong> - Crée un nouvel utilisateur</li>
            <li><strong>GET /api/users/:id</strong> - Récupère les détails d'un utilisateur</li>
            <li><strong>PUT /api/users/:id</strong> - Met à jour un utilisateur</li>
            <li><strong>DELETE /api/users/:id</strong> - Supprime un utilisateur</li>
          </ul>
        </div>
        
        <div class="tech-spec">
          <div class="tech-spec-title">API de Statistiques et Monitoring</div>
          <ul>
            <li><strong>GET /api/stats</strong> - Récupère les statistiques du système (conversions, temps de traitement, etc.)</li>
            <li><strong>GET /api/cache/status</strong> - Récupère les informations sur l'état du cache de conversion</li>
          </ul>
        </div>
        
        <div class="tech-spec">
          <div class="tech-spec-title">API de Workflows</div>
          <ul>
            <li><strong>GET /api/workflows</strong> - Liste tous les workflows</li>
            <li><strong>POST /api/workflows</strong> - Crée un nouveau workflow</li>
            <li><strong>GET /api/workflows/:id</strong> - Récupère un workflow spécifique</li>
            <li><strong>PUT /api/workflows/:id</strong> - Met à jour un workflow existant</li>
            <li><strong>DELETE /api/workflows/:id</strong> - Supprime un workflow</li>
            <li><strong>GET /api/workflows/application/:applicationId</strong> - Récupère les workflows associés à une application</li>
            <li><strong>POST /api/workflows/execute/:id</strong> - Exécute manuellement un workflow</li>
          </ul>
        </div>
        
        <div class="tech-spec">
          <div class="tech-spec-title">API d'IA et d'Assistance</div>
          <ul>
            <li><strong>GET /api/ai-providers</strong> - Liste tous les fournisseurs d'IA configurés</li>
            <li><strong>POST /api/ai-providers</strong> - Configure un nouveau fournisseur d'IA</li>
            <li><strong>GET /api/ai-providers/:id</strong> - Récupère les détails d'un fournisseur d'IA</li>
            <li><strong>PUT /api/ai-providers/:id</strong> - Met à jour la configuration d'un fournisseur d'IA</li>
            <li><strong>DELETE /api/ai-providers/:id</strong> - Supprime un fournisseur d'IA</li>
            <li><strong>POST /api/ai-chat/message</strong> - Envoie un message au chatbot de support</li>
            <li><strong>GET /api/ai-chat/history</strong> - Récupère l'historique des conversations avec le chatbot</li>
          </ul>
        </div>
        
        <div class="tech-spec">
          <div class="tech-spec-title">API de Documentation</div>
          <ul>
            <li><strong>GET /api-docs</strong> - Documentation Swagger des APIs disponibles</li>
            <li><strong>GET /api-docs.json</strong> - Spécification OpenAPI au format JSON</li>
          </ul>
        </div>
        

        
        <h3>Authentification</h3>
        <p>Les API nécessitent une authentification, qui peut se faire de deux manières :</p>
        <ul>
          <li><strong>Clé API</strong> : Envoyée dans l'en-tête HTTP <code>X-API-KEY</code></li>
          <li><strong>JWT Token</strong> : Envoyé dans l'en-tête HTTP <code>Authorization: Bearer &lt;token&gt;</code></li>
        </ul>
        
        <div class="tip-box">
          <p><strong>Conseil :</strong> Pour tester les API via la documentation Swagger, utilisez le bouton <strong>Autoriser</strong> et saisissez la clé de test : <code>dev-key</code> dans le champ apiKey.</p>
        </div>
        
        <h3>Exemples d'utilisation</h3>
        
        <div class="code-tabs">
          <div class="tab-buttons">
            <button class="tab-button active" onclick="switchTab(event, 'curl-tab')">cURL</button>
            <button class="tab-button" onclick="switchTab(event, 'js-tab')">JavaScript</button>
            <button class="tab-button" onclick="switchTab(event, 'python-tab')">Python</button>
          </div>
          
          <div id="curl-tab" class="tab-content" style="display: block;">
            <h4>Conversion avec JSON (POST /api/convert)</h4>
            <pre class="code-block">curl -X POST "http://localhost:5000/api/convert" \
     -H "Content-Type: application/json" \
     -H "X-API-KEY: your-api-key" \
     -d '{"hl7Message": "MSH|^~\\&|SENDING_APP|SENDING_FACILITY|RECEIVING_APP|RECEIVING_FACILITY|20230801101530||ADT^A01|20230801101530|P|2.5|||||FRA|UNICODE UTF-8|||LAB_HL7_V2\nPID|1||458722781^^^CENTRE_HOSPITALIER_DE_TEST^PI||SECLET^MARYSE BERTHE ALICE||19830711|F"}'</pre>
            
            <h4>Conversion avec texte brut (POST /api/convert/raw)</h4>
            <pre class="code-block">curl -X POST "http://localhost:5000/api/convert/raw" \
     -H "Content-Type: text/plain" \
     -H "X-API-KEY: your-api-key" \
     -d 'MSH|^~\&|SENDING_APP|SENDING_FACILITY|RECEIVING_APP|RECEIVING_FACILITY|20230801101530||ADT^A01|20230801101530|P|2.5|||||FRA|UNICODE UTF-8|||LAB_HL7_V2
PID|1||458722781^^^CENTRE_HOSPITALIER_DE_TEST^PI||SECLET^MARYSE BERTHE ALICE||19830711|F'</pre>
            
            <h4>Statistiques du système (GET /api/stats)</h4>
            <pre class="code-block">curl -X GET "http://localhost:5000/api/stats" \
     -H "X-API-KEY: your-api-key"</pre>
          </div>
          
          <div id="js-tab" class="tab-content" style="display: none;">
            <h4>Conversion avec fetch API</h4>
            <pre class="code-block">const convertHL7ToFHIR = async (hl7Message) => {
  try {
    const response = await fetch('http://localhost:5000/api/convert', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-API-KEY': 'your-api-key'
      },
      body: JSON.stringify({ hl7Message })
    });
    
    const result = await response.json();
    
    if (!result.success) {
      throw new Error(result.message || 'Erreur de conversion');
    }
    
    return result.data;
  } catch (error) {
    console.error('Erreur lors de la conversion:', error);
    throw error;
  }
};

// Exemple d'utilisation
const hl7Message = `MSH|^~\\&|SENDING_APP|SENDING_FACILITY|RECEIVING_APP|RECEIVING_FACILITY|20230801101530||ADT^A01|20230801101530|P|2.5|||||FRA|UNICODE UTF-8|||LAB_HL7_V2
PID|1||458722781^^^CENTRE_HOSPITALIER_DE_TEST^PI||SECLET^MARYSE BERTHE ALICE||19830711|F`;

convertHL7ToFHIR(hl7Message)
  .then(fhirBundle => {
    console.log('Bundle FHIR généré:', fhirBundle);
  })
  .catch(error => {
    console.error('Erreur:', error);
  });</pre>
          </div>
          
          <div id="python-tab" class="tab-content" style="display: none;">
            <h4>Conversion avec requests</h4>
            <pre class="code-block">import requests
import json

def convert_hl7_to_fhir(hl7_message, api_key, base_url='http://localhost:5000'):
    """
    Convertit un message HL7 en FHIR à l'aide de l'API FHIRHub
    
    Args:
        hl7_message (str): Message HL7 à convertir
        api_key (str): Clé API pour l'authentification
        base_url (str): URL de base de l'API
        
    Returns:
        dict: Bundle FHIR résultant
    """
    url = f"{base_url}/api/convert"
    
    headers = {
        'Content-Type': 'application/json',
        'X-API-KEY': api_key
    }
    
    payload = {
        'hl7Message': hl7_message
    }
    
    try:
        response = requests.post(url, headers=headers, json=payload)
        response.raise_for_status()  # Lève une exception pour les codes d'erreur HTTP
        
        result = response.json()
        
        if not result.get('success'):
            raise ValueError(result.get('message', 'Erreur inconnue lors de la conversion'))
            
        return result['data']
    except requests.exceptions.RequestException as e:
        print(f"Erreur réseau: {e}")
        raise
    except ValueError as e:
        print(f"Erreur de traitement: {e}")
        raise
    except Exception as e:
        print(f"Erreur inattendue: {e}")
        raise

# Exemple d'utilisation
if __name__ == "__main__":
    hl7_message = """MSH|^~\\&|SENDING_APP|SENDING_FACILITY|RECEIVING_APP|RECEIVING_FACILITY|20230801101530||ADT^A01|20230801101530|P|2.5|||||FRA|UNICODE UTF-8|||LAB_HL7_V2
PID|1||458722781^^^CENTRE_HOSPITALIER_DE_TEST^PI||SECLET^MARYSE BERTHE ALICE||19830711|F"""
    
    try:
        fhir_bundle = convert_hl7_to_fhir(hl7_message, api_key="your-api-key")
        print(f"Bundle FHIR généré avec {len(fhir_bundle['entry'])} ressources")
        
        # Sauvegarder le résultat dans un fichier
        with open('fhir_bundle.json', 'w', encoding='utf-8') as f:
            json.dump(fhir_bundle, f, ensure_ascii=False, indent=2)
            
        print("Résultat sauvegardé dans fhir_bundle.json")
    except Exception as e:
        print(f"Échec de la conversion: {e}")</pre>
          </div>
        </div>
        
        <script>
          function switchTab(event, tabId) {
            // Masquer tous les contenus d'onglets
            const tabContents = document.getElementsByClassName("tab-content");
            for (let i = 0; i < tabContents.length; i++) {
              tabContents[i].style.display = "none";
            }
            
            // Désactiver tous les boutons d'onglets
            const tabButtons = document.getElementsByClassName("tab-button");
            for (let i = 0; i < tabButtons.length; i++) {
              tabButtons[i].className = tabButtons[i].className.replace(" active", "");
            }
            
            // Afficher le contenu d'onglet actif et activer le bouton correspondant
            document.getElementById(tabId).style.display = "block";
            event.currentTarget.className += " active";
          }
        </script>
        
        <style>
          .code-tabs {
            margin: 20px 0;
          }
          
          .tab-buttons {
            display: flex;
            margin-bottom: -1px;
          }
          
          .tab-button {
            padding: 10px 15px;
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            border-bottom: none;
            cursor: pointer;
            margin-right: 5px;
            border-top-left-radius: 5px;
            border-top-right-radius: 5px;
          }
          
          .tab-button.active {
            background-color: #fff;
            border-bottom: 1px solid #fff;
            position: relative;
            z-index: 1;
            font-weight: bold;
            color: #ff5722;
          }
          
          .tab-content {
            border: 1px solid #ddd;
            padding: 15px;
            background-color: #fff;
          }
          
          .tab-content h4 {
            margin-top: 0;
            margin-bottom: 10px;
            color: #ff5722;
          }
        </style>
      </div>
      
      <div id="cache" class="documentation-section">
        <h2>Système de Cache Intelligent</h2>
        <p>FHIRHub intègre un système de cache intelligent pour optimiser les performances lors de la conversion de messages HL7 vers FHIR. Ce système permet de réduire drastiquement le temps de traitement pour les messages identiques ou similaires.</p>
        
        <h3>Architecture du système de cache</h3>
        <p>Le cache fonctionne à deux niveaux :</p>
        
        <div class="workflow-step">
          <div class="step-number">1</div>
          <div class="step-content">
            <div class="step-title">Cache mémoire (LRU)</div>
            <div class="step-description">Stockage en mémoire vive des 500 dernières conversions avec une stratégie Least Recently Used pour optimiser l'utilisation de la mémoire.</div>
          </div>
        </div>
        
        <div class="workflow-step">
          <div class="step-number">2</div>
          <div class="step-content">
            <div class="step-title">Cache persistant sur disque</div>
            <div class="step-description">Sauvegarde sur disque pour conserver les résultats des conversions entre les redémarrages du serveur.</div>
          </div>
        </div>
        
        <h3>Fonctionnement du cache</h3>
        <p>Le système utilise un hachage SHA-256 du message HL7 comme clé pour retrouver rapidement les résultats des conversions précédentes.</p>
        
        <div class="tech-spec">
          <div class="tech-spec-title">Performance</div>
          <ul>
            <li><strong>Sans cache :</strong> ~10-50ms par conversion selon la complexité du message</li>
            <li><strong>Avec cache mémoire :</strong> &lt;1ms (presque instantané)</li>
            <li><strong>Avec cache disque :</strong> ~2-5ms</li>
          </ul>
        </div>
        
        <p>Pour des détails complets sur le système de cache, consultez la <a href="/docs/cache_system">documentation dédiée</a>.</p>
        
        <h3>API de gestion du cache</h3>
        <div class="tech-spec">
          <div class="tech-spec-title">Endpoints pour le cache</div>
          <ul>
            <li><strong>GET /api/cache/stats</strong> - Statistiques du cache (taille, hits, misses)</li>
            <li><strong>POST /api/cache/clear</strong> - Vider le cache (admin uniquement)</li>
          </ul>
        </div>
      </div>
      
      <div id="database" class="documentation-section">
        <h2>Structure de la Base de Données</h2>
        <p>FHIRHub utilise SQLite comme système de gestion de base de données pour garantir une portabilité maximale sans dépendance externe.</p>
        
        <h3>Schéma de la base de données</h3>
        <p>La base de données est organisée en plusieurs tables qui stockent l'ensemble des données nécessaires au fonctionnement de l'application :</p>
        
        <div class="tech-spec">
          <div class="tech-spec-title">Tables principales</div>
          <ul>
            <li><strong>users</strong> - Informations utilisateurs (admin, user)</li>
            <li><strong>applications</strong> - Applications enregistrées dans le système</li>
            <li><strong>api_keys</strong> - Clés API associées aux applications</li>
            <li><strong>conversion_logs</strong> - Historique des conversions HL7 vers FHIR</li>
            <li><strong>system_metrics</strong> - Métriques système (CPU, mémoire)</li>
            <li><strong>notifications</strong> - Notifications système</li>
            <li><strong>api_activity_logs</strong> - Journaux d'activité des API</li>
            <li><strong>api_usage_limits</strong> - Limites d'utilisation des API</li>
          </ul>
        </div>
        
        <p>Pour une description détaillée du schéma de base de données, y compris les relations entre les tables et les champs spécifiques, consultez la <a href="/docs/database_schema">documentation complète du schéma</a>.</p>
        
        <h3>Gestion des données</h3>
        <p>La base de données est automatiquement initialisée lors du premier démarrage de l'application. Des sauvegardes automatiques sont effectuées quotidiennement dans le dossier <code>data/backups</code>.</p>
        
        <div class="info-box">
          <p><strong>Note :</strong> Par défaut, les logs de conversion sont conservés pendant 30 jours maximum pour éviter une croissance excessive de la base de données.</p>
        </div>
      </div>
      
      <div id="docker" class="documentation-section">
        <h2>Déploiement avec Docker</h2>
        <p>FHIRHub offre une solution de déploiement basée sur Docker qui facilite l'installation, la maintenance et les mises à jour de l'application.</p>
        
        <h3>Architecture Docker</h3>
        <p>L'architecture Docker de FHIRHub s'appuie sur des volumes persistants pour garantir la pérennité des données :</p>
        
        <div class="workflow-step">
          <div class="step-number">1</div>
          <div class="step-content">
            <div class="step-title">Volumes persistants</div>
            <div class="step-description">Les données essentielles (base de données, cache, logs, terminologies) sont stockées dans des volumes persistants indépendants du conteneur.</div>
          </div>
        </div>
        
        <div class="workflow-step">
          <div class="step-number">2</div>
          <div class="step-content">
            <div class="step-title">Script d'initialisation</div>
            <div class="step-description">Le script <code>docker-init.sh</code> automatise la configuration pour un déploiement rapide et simplifié.</div>
          </div>
        </div>
        
        <div class="workflow-step">
          <div class="step-number">3</div>
          <div class="step-content">
            <div class="step-title">Configuration par environnement</div>
            <div class="step-description">Les variables d'environnement permettent de personnaliser le déploiement selon les besoins (ports, chemins, secrets).</div>
          </div>
        </div>
        
        <h3>Méthodes de déploiement</h3>
        <pre class="code-block"># Méthode rapide (recommandée)
./docker-init.sh
docker-compose -f docker-compose.prod.yml up -d

# Accès à l'application
http://localhost:5000  # Identifiants : admin / adminfhirhub</pre>
        
        <div class="tech-spec">
          <div class="tech-spec-title">Fonctionnalités Docker</div>
          <ul>
            <li><strong>Sauvegarde automatique</strong> des données dans des volumes persistants</li>
            <li><strong>Multi-environnement</strong> avec configurations développement et production</li>
            <li><strong>Mises à jour simplifiées</strong> sans perte de données</li>
            <li><strong>Support HTTPS</strong> via configuration avec reverse proxy</li>
          </ul>
        </div>
        
        <p>Pour une documentation complète sur le déploiement Docker, consultez <a href="/docs/docker_deployment">le guide détaillé de déploiement</a>.</p>
      </div>
      
      <div id="terminology-page" class="documentation-section">
        <h2>Gestion des Nomenclatures Médicales</h2>
        <p>FHIRHub propose une interface complète pour gérer les nomenclatures médicales françaises nécessaires à la conversion précise des messages HL7 vers FHIR, accessible via le menu "Nomenclatures".</p>
        
        <h3>Fonctionnement de la page des nomenclatures</h3>
        
        <div class="workflow-step">
          <div class="step-number">1</div>
          <div class="step-content">
            <div class="step-title">Tableau de bord des terminologies</div>
            <div class="step-description">La page affiche les statistiques clés : version des terminologies françaises, date de dernière mise à jour, nombre de systèmes de codes et d'OIDs disponibles pour la conversion.</div>
          </div>
        </div>
        
        <div class="workflow-step">
          <div class="step-number">2</div>
          <div class="step-content">
            <div class="step-title">Importation de fichiers</div>
            <div class="step-description">L'interface permet d'importer des fichiers JSON contenant des ValueSets, CodeSystems ou OIDs par simple glisser-déposer ou sélection de fichier. Le système analyse automatiquement le contenu et l'intègre aux mappings existants.</div>
          </div>
        </div>
        
        <div class="workflow-step">
          <div class="step-number">3</div>
          <div class="step-content">
            <div class="step-title">Gestion des fichiers</div>
            <div class="step-description">Visualisation, édition de description et suppression des fichiers importés (à l'exception des fichiers système protégés). Les fichiers de nomenclature importés sont immédiatement disponibles pour la conversion.</div>
          </div>
        </div>
        
        <div class="workflow-step">
          <div class="step-number">4</div>
          <div class="step-content">
            <div class="step-title">Utilisation dans le convertisseur</div>
            <div class="step-description">Lors de la conversion HL7 vers FHIR, le système consulte automatiquement tous les fichiers de nomenclature pour enrichir les ressources FHIR avec les codes et systèmes français appropriés.</div>
          </div>
        </div>
        
        <h3>Types de fichiers supportés</h3>
        <div class="tech-spec">
          <div class="tech-spec-title">Formats de fichiers de nomenclature</div>
          <ul>
            <li><strong>ValueSets FHIR</strong> - Ensembles de valeurs validées pour différents concepts médicaux</li>
            <li><strong>CodeSystems FHIR</strong> - Systèmes de codification avec les codes et leurs définitions</li>
            <li><strong>Bundles FHIR</strong> - Collections de ressources FHIR de terminologie</li>
            <li><strong>Fichiers OIDs</strong> - Mappings des identifiants d'objets utilisés dans le système de santé français</li>
          </ul>
        </div>
        
        <h3>Processus d'utilisation des fichiers</h3>
        <p>Lorsqu'un fichier de nomenclature est importé :</p>
        <ol>
          <li>Le système analyse son contenu pour déterminer s'il contient des ValueSets, CodeSystems ou OIDs</li>
          <li>Les éléments sont extraits et intégrés dans la base de connaissances du convertisseur</li>
          <li>Pendant la conversion, pour chaque code HL7 rencontré, le système recherche dans tous les fichiers de nomenclature importés pour trouver les correspondances FHIR</li>
          <li>Si une correspondance est trouvée, la ressource FHIR est enrichie avec non seulement le code, mais aussi ses métadonnées (système, version, libellé)</li>
        </ol>
        
        <div class="warning-box">
          <p><strong>Important :</strong> Les fichiers système (ans_oids.json, ans_common_codes.json, ans_terminology_systems.json) sont protégés et ne peuvent pas être supprimés car ils contiennent les mappings fondamentaux pour la conversion.</p>
        </div>
        
        <p>Pour en savoir plus sur l'intégration avec les terminologies françaises, consultez la documentation dans le dossier <code>/docs/</code> du projet et les fichiers de configuration dans le dossier <code>/french_terminology/</code>.</p>
      </div>
      
      <div id="prerequites" class="documentation-section">
        <h2>Prérequis et installation</h2>
        <p>FHIRHub est conçu pour être facilement déployable avec un minimum de dépendances.</p>
        
        <h3>Configuration requise</h3>
        <ul>
          <li><strong>Node.js</strong> version 18.x ou 20.x (v20.15.1 recommandée) - attention, problèmes connus avec Node.js v22</li>
          <li><strong>SQLite3</strong> (inclus, ne nécessite pas d'installation séparée)</li>
          <li><strong>OS :</strong> Windows, macOS ou Linux</li>
          <li><strong>RAM :</strong> 2 Go minimum, 4 Go recommandé</li>
          <li><strong>Espace disque :</strong> 200 Mo minimum</li>
          <li><strong>Navigateur :</strong> Chrome, Firefox, Edge ou Safari récent</li>
        </ul>
        
        <h3>Installation</h3>
        <p>L'installation de FHIRHub est simple et ne nécessite que quelques étapes :</p>
        
        <ol>
          <li>Décompressez l'archive dans le dossier de votre choix</li>
          <li>Ouvrez un terminal dans ce dossier</li>
          <li>Exécutez <code>npm install</code> pour installer les dépendances</li>
          <li>Exécutez <code>bash start.sh</code> pour démarrer le serveur</li>
          <li>Accédez à <code>http://localhost:5000</code> dans votre navigateur</li>
        </ol>
        
        <div class="info-box">
          <p><strong>Note :</strong> Lors du premier démarrage, le système crée automatiquement un utilisateur administrateur avec les identifiants par défaut : <code>admin / adminfhirhub</code>. Il est fortement recommandé de changer ce mot de passe après la première connexion.</p>
        </div>
        
        <h3>Sauvegarde</h3>
        <p>Pour sauvegarder vos données, il suffit de copier le fichier <code>data/fhirhub.db</code> qui contient toute la base de données (utilisateurs, applications, clés API, logs).</p>
      </div>
      
      <a href="#" class="back-to-top">
        <i class="fas fa-arrow-up"></i>
      </a>
    </div>
  </div>
  
  <footer class="footer">
    <div class="container">
      <div class="footer-text">
        &copy; 2025 FHIRHub - Service de conversion HL7 vers FHIR
      </div>
      <ul class="footer-links">
        <li><a href="/documentation.html">Documentation</a></li>
        <li><a href="/api-docs">API</a></li>
      </ul>
    </div>
  </footer>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Vérifier l'authentification
      const token = localStorage.getItem('token');
      if (!token) {
        window.location.href = '/login.html';
        return;
      }
      
      // Gestion du bouton de déconnexion
      document.getElementById('logoutBtn').addEventListener('click', function(e) {
        e.preventDefault();
        localStorage.removeItem('token');
        localStorage.removeItem('user');
        window.location.href = '/login.html';
      });
      
      // Navigation fluide
      document.querySelectorAll('.section-nav a').forEach(anchor => {
        anchor.addEventListener('click', function(e) {
          e.preventDefault();
          
          // Mise à jour des classes actives
          document.querySelectorAll('.section-nav a').forEach(a => a.classList.remove('active'));
          this.classList.add('active');
          
          const targetId = this.getAttribute('href').substring(1);
          const targetElement = document.getElementById(targetId);
          
          window.scrollTo({
            top: targetElement.offsetTop - 100,
            behavior: 'smooth'
          });
        });
      });
      
      // Bouton retour en haut
      const backToTopButton = document.querySelector('.back-to-top');
      
      window.addEventListener('scroll', () => {
        if (window.pageYOffset > 300) {
          backToTopButton.classList.add('visible');
        } else {
          backToTopButton.classList.remove('visible');
        }
      });
      
      backToTopButton.addEventListener('click', e => {
        e.preventDefault();
        window.scrollTo({
          top: 0,
          behavior: 'smooth'
        });
      });
      
      // Détecter la section active pendant le défilement
      const sections = document.querySelectorAll('.documentation-section');
      const navLinks = document.querySelectorAll('.section-nav a');
      
      window.addEventListener('scroll', () => {
        let current = '';
        
        sections.forEach(section => {
          const sectionTop = section.offsetTop - 150;
          const sectionHeight = section.clientHeight;
          
          if (window.pageYOffset >= sectionTop) {
            current = section.getAttribute('id');
          }
        });
        
        navLinks.forEach(link => {
          link.classList.remove('active');
          if (link.getAttribute('href').substring(1) === current) {
            link.classList.add('active');
          }
        });
      });
      
      // Gestionnaire pour les boîtes dépliables
      const collapsibles = document.querySelectorAll('.collapsible');
      
      collapsibles.forEach(coll => {
        coll.addEventListener('click', function() {
          this.classList.toggle('active');
          const content = this.nextElementSibling;
          
          if (content.style.maxHeight) {
            content.style.maxHeight = null;
            this.querySelector('i').className = 'fas fa-chevron-down';
          } else {
            content.style.maxHeight = content.scrollHeight + 'px';
            this.querySelector('i').className = 'fas fa-chevron-up';
          }
        });
      });
    });
  </script>
</body>
</html>