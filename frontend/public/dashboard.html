<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FHIRHub - Tableau de bord</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="img/favicon.png">
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="logo">
                <h1>FHIR<span>Hub</span></h1>
            </div>
            <nav class="main-nav">
                <ul>
                    <li><a href="index.html">Accueil</a></li>
                    <li><a href="converter.html">Convertisseur</a></li>
                    <li><a href="dashboard.html" class="active">Tableau de bord</a></li>
                    <li><a href="api-docs.html">Documentation API</a></li>
                    <li><a href="logout" id="logout-btn">Déconnexion</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="dashboard-container">
        <div class="sidebar">
            <div class="user-info">
                <div class="user-avatar">
                    <span>A</span>
                </div>
                <div class="user-details">
                    <h3 id="user-name">Admin</h3>
                    <p id="user-role">Administrateur</p>
                </div>
            </div>
            <nav class="sidebar-nav">
                <ul>
                    <li><a href="#" class="active" data-section="system-stats">Vue d'ensemble</a></li>
                    <li><a href="#" data-section="applications">Applications</a></li>
                    <li><a href="#" data-section="api-keys">Clés API</a></li>
                    <li><a href="#" data-section="logs">Journaux de conversion</a></li>
                    <li><a href="#" data-section="settings">Paramètres</a></li>
                </ul>
            </nav>
            <div class="system-status">
                <div class="status-item">
                    <div class="status-label">CPU</div>
                    <div class="status-bar">
                        <div class="status-bar-fill" id="cpu-usage" style="width: 25%;"></div>
                    </div>
                    <div class="status-value" id="cpu-value">25%</div>
                </div>
                <div class="status-item">
                    <div class="status-label">RAM</div>
                    <div class="status-bar">
                        <div class="status-bar-fill" id="ram-usage" style="width: 40%;"></div>
                    </div>
                    <div class="status-value" id="ram-value">40%</div>
                </div>
                <div class="status-item">
                    <div class="status-label">Stockage</div>
                    <div class="status-bar">
                        <div class="status-bar-fill" id="disk-usage" style="width: 15%;"></div>
                    </div>
                    <div class="status-value" id="disk-value">15%</div>
                </div>
            </div>
        </div>

        <div class="content">
            <!-- Section Vue d'ensemble -->
            <section id="system-stats" class="dashboard-section active">
                <h2>Vue d'ensemble du système</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25zM6.75 12h.008v.008H6.75V12zm0 3h.008v.008H6.75V15zm0 3h.008v.008H6.75V18z" />
                            </svg>
                        </div>
                        <div class="stat-content">
                            <h3>Conversions totales</h3>
                            <p class="stat-value" id="total-conversions">0</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 5.25a3 3 0 013 3m3 0a6 6 0 01-7.029 5.912c-.563-.097-1.159.026-1.563.43L10.5 17.25H8.25v2.25H6v2.25H2.25v-2.818c0-.597.237-1.17.659-1.591l6.499-6.499c.404-.404.527-1 .43-1.563A6 6 0 1121.75 8.25z" />
                            </svg>
                        </div>
                        <div class="stat-content">
                            <h3>Clés API actives</h3>
                            <p class="stat-value" id="active-keys">0</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M21 7.5l-9-5.25L3 7.5m18 0l-9 5.25m9-5.25v9l-9 5.25M3 7.5l9 5.25M3 7.5v9l9 5.25m0-9v9" />
                            </svg>
                        </div>
                        <div class="stat-content">
                            <h3>Applications</h3>
                            <p class="stat-value" id="total-applications">0</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z" />
                            </svg>
                        </div>
                        <div class="stat-content">
                            <h3>Taux de succès</h3>
                            <p class="stat-value" id="success-rate">0%</p>
                        </div>
                    </div>
                </div>
                
                <div class="charts-container">
                    <div class="chart-card">
                        <h3>Conversions par jour</h3>
                        <div class="chart-placeholder" id="conversions-chart">
                            <p>Graphique des conversions quotidiennes</p>
                        </div>
                    </div>
                    
                    <div class="chart-card">
                        <h3>Utilisation des API par application</h3>
                        <div class="chart-placeholder" id="api-usage-chart">
                            <p>Graphique d'utilisation des API</p>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Section Applications -->
            <section id="applications" class="dashboard-section">
                <div class="section-header">
                    <h2>Gestion des applications</h2>
                    <button id="create-app-btn" class="btn primary">Nouvelle application</button>
                </div>
                
                <div class="search-filter">
                    <div class="search-box">
                        <input type="text" id="app-search" placeholder="Rechercher une application...">
                        <button class="search-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
                            </svg>
                        </button>
                    </div>
                    <div class="filters">
                        <select id="app-status-filter">
                            <option value="all">Tous les statuts</option>
                            <option value="active">Actives</option>
                            <option value="inactive">Inactives</option>
                        </select>
                    </div>
                </div>
                
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Nom</th>
                                <th>Propriétaire</th>
                                <th>Statut</th>
                                <th>Clés API</th>
                                <th>Utilisation totale</th>
                                <th>Date de création</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="applications-table-body">
                            <!-- Les données seront insérées ici par JavaScript -->
                            <tr class="empty-table">
                                <td colspan="7">Aucune application trouvée</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="pagination">
                    <button class="pagination-btn" id="prev-apps-page" disabled>Précédent</button>
                    <span class="pagination-info" id="apps-page-info">Page 1 sur 1</span>
                    <button class="pagination-btn" id="next-apps-page" disabled>Suivant</button>
                </div>
            </section>
            
            <!-- Section Clés API -->
            <section id="api-keys" class="dashboard-section">
                <div class="section-header">
                    <h2>Gestion des clés API</h2>
                    <button id="create-key-btn" class="btn primary">Nouvelle clé API</button>
                </div>
                
                <div class="search-filter">
                    <div class="search-box">
                        <input type="text" id="key-search" placeholder="Rechercher une clé API...">
                        <button class="search-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
                            </svg>
                        </button>
                    </div>
                    <div class="filters">
                        <select id="key-app-filter">
                            <option value="all">Toutes les applications</option>
                            <!-- Les options seront ajoutées dynamiquement -->
                        </select>
                        <select id="key-env-filter">
                            <option value="all">Tous les environnements</option>
                            <option value="production">Production</option>
                            <option value="qualification">Qualification</option>
                            <option value="development">Développement</option>
                        </select>
                        <select id="key-status-filter">
                            <option value="all">Tous les statuts</option>
                            <option value="1">Actives</option>
                            <option value="0">Révoquées</option>
                        </select>
                    </div>
                </div>
                
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Nom de la clé</th>
                                <th>Application</th>
                                <th>Clé</th>
                                <th>Environnement</th>
                                <th>Statut</th>
                                <th>Utilisation</th>
                                <th>Date d'expiration</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="api-keys-table-body">
                            <!-- Les données seront insérées ici par JavaScript -->
                            <tr class="empty-table">
                                <td colspan="8">Aucune clé API trouvée</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="pagination">
                    <button class="pagination-btn" id="prev-keys-page" disabled>Précédent</button>
                    <span class="pagination-info" id="keys-page-info">Page 1 sur 1</span>
                    <button class="pagination-btn" id="next-keys-page" disabled>Suivant</button>
                </div>
            </section>
            
            <!-- Section Journaux de conversion -->
            <section id="logs" class="dashboard-section">
                <div class="section-header">
                    <h2>Journaux de conversion</h2>
                    <div class="actions">
                        <button id="export-logs-btn" class="btn secondary">Exporter</button>
                        <button id="clear-logs-btn" class="btn danger">Nettoyer</button>
                    </div>
                </div>
                
                <div class="search-filter">
                    <div class="search-box">
                        <input type="text" id="log-search" placeholder="Rechercher dans les journaux...">
                        <button class="search-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
                            </svg>
                        </button>
                    </div>
                    <div class="filters">
                        <select id="log-app-filter">
                            <option value="all">Toutes les applications</option>
                            <!-- Les options seront ajoutées dynamiquement -->
                        </select>
                        <select id="log-status-filter">
                            <option value="all">Tous les statuts</option>
                            <option value="success">Succès</option>
                            <option value="error">Erreur</option>
                        </select>
                        <select id="log-period-filter">
                            <option value="all">Toute période</option>
                            <option value="today">Aujourd'hui</option>
                            <option value="yesterday">Hier</option>
                            <option value="week">Cette semaine</option>
                            <option value="month">Ce mois</option>
                        </select>
                    </div>
                </div>
                
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Date/Heure</th>
                                <th>Application</th>
                                <th>Clé API</th>
                                <th>Type de source</th>
                                <th>Statut</th>
                                <th>Temps de traitement</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="logs-table-body">
                            <!-- Les données seront insérées ici par JavaScript -->
                            <tr class="empty-table">
                                <td colspan="7">Aucun journal de conversion trouvé</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="pagination">
                    <button class="pagination-btn" id="prev-logs-page" disabled>Précédent</button>
                    <span class="pagination-info" id="logs-page-info">Page 1 sur 1</span>
                    <button class="pagination-btn" id="next-logs-page" disabled>Suivant</button>
                </div>
            </section>
            
            <!-- Section Paramètres -->
            <section id="settings" class="dashboard-section">
                <h2>Paramètres du système</h2>
                
                <div class="settings-grid">
                    <div class="settings-card">
                        <h3>Configuration générale</h3>
                        <form id="general-settings-form">
                            <div class="form-group">
                                <label for="app-name">Nom de l'application</label>
                                <input type="text" id="app-name" value="FHIRHub">
                            </div>
                            <div class="form-group">
                                <label for="retention-period">Période de rétention des logs (jours)</label>
                                <input type="number" id="retention-period" value="30" min="1" max="365">
                            </div>
                            <div class="form-group">
                                <label for="default-rate-limit">Limite de taux par défaut (requêtes/minute)</label>
                                <input type="number" id="default-rate-limit" value="100" min="1">
                            </div>
                            <div class="form-check">
                                <input type="checkbox" id="enable-metrics" checked>
                                <label for="enable-metrics">Activer la collecte de métriques</label>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn primary">Enregistrer</button>
                                <button type="reset" class="btn secondary">Réinitialiser</button>
                            </div>
                        </form>
                    </div>
                    
                    <div class="settings-card">
                        <h3>Configuration des terminologies</h3>
                        <form id="terminology-settings-form">
                            <div class="form-group">
                                <label for="terminology-mode">Mode de fonctionnement</label>
                                <select id="terminology-mode">
                                    <option value="offline">Hors ligne (utiliser les fichiers locaux)</option>
                                    <option value="hybrid">Hybride (local + serveur ANS si disponible)</option>
                                    <option value="online">En ligne (interroger le serveur ANS)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="terminology-url">URL du serveur Multi-Terminologies</label>
                                <input type="url" id="terminology-url" value="https://smt.esante.gouv.fr/fhir/">
                            </div>
                            <div class="form-check">
                                <input type="checkbox" id="enable-auth" checked>
                                <label for="enable-auth">Activer l'authentification</label>
                            </div>
                            <div class="form-group auth-field">
                                <label for="client-id">Identifiant client</label>
                                <input type="text" id="client-id" placeholder="Identifiant client pour le serveur SMT">
                            </div>
                            <div class="form-group auth-field">
                                <label for="client-secret">Secret client</label>
                                <input type="password" id="client-secret" placeholder="Secret client pour le serveur SMT">
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn primary">Enregistrer</button>
                                <button type="button" id="test-connection-btn" class="btn secondary">Tester la connexion</button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <div class="settings-card full-width">
                    <h3>Gestion des utilisateurs</h3>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Nom d'utilisateur</th>
                                    <th>Email</th>
                                    <th>Rôle</th>
                                    <th>Dernière connexion</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="users-table-body">
                                <!-- Les données seront insérées ici par JavaScript -->
                                <tr>
                                    <td>admin</td>
                                    <td>admin@fhirhub.local</td>
                                    <td><span class="badge admin">Administrateur</span></td>
                                    <td>28/04/2025 19:00</td>
                                    <td>
                                        <button class="action-btn edit-btn" disabled>Modifier</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="form-actions">
                        <button id="add-user-btn" class="btn primary">Ajouter un utilisateur</button>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Modales -->
    <div class="modal" id="create-app-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Créer une nouvelle application</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="create-app-form">
                    <div class="form-group">
                        <label for="new-app-name">Nom de l'application</label>
                        <input type="text" id="new-app-name" required>
                    </div>
                    <div class="form-group">
                        <label for="new-app-description">Description</label>
                        <textarea id="new-app-description" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="new-app-status">Statut</label>
                        <select id="new-app-status">
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn secondary close-modal">Annuler</button>
                <button class="btn primary" id="save-new-app-btn">Créer</button>
            </div>
        </div>
    </div>

    <div class="modal" id="create-key-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Créer une nouvelle clé API</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="create-key-form">
                    <div class="form-group">
                        <label for="new-key-name">Nom de la clé</label>
                        <input type="text" id="new-key-name" required>
                    </div>
                    <div class="form-group">
                        <label for="new-key-app">Application</label>
                        <select id="new-key-app" required>
                            <!-- Les options seront ajoutées dynamiquement -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="new-key-env">Environnement</label>
                        <select id="new-key-env">
                            <option value="development">Développement</option>
                            <option value="qualification">Qualification</option>
                            <option value="production">Production</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="new-key-expires">Date d'expiration (optionnel)</label>
                        <input type="date" id="new-key-expires">
                    </div>
                    <div class="form-group">
                        <label for="new-key-rate-limit">Limite de taux (requêtes/minute)</label>
                        <input type="number" id="new-key-rate-limit" value="100" min="1">
                    </div>
                    <div class="form-group">
                        <label for="new-key-ip">Restrictions IP (optionnel, séparées par des virgules)</label>
                        <input type="text" id="new-key-ip" placeholder="192.168.1.1, 10.0.0.0/24">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn secondary close-modal">Annuler</button>
                <button class="btn primary" id="save-new-key-btn">Créer</button>
            </div>
        </div>
    </div>

    <div class="modal" id="key-created-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Clé API créée avec succès</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <p>Votre nouvelle clé API a été créée. Veuillez conserver cette clé de manière sécurisée, car elle ne sera plus affichée ultérieurement.</p>
                <div class="api-key-display">
                    <code id="new-api-key-display">fhir_xxxxxxxxxxxxxxxxxxxx</code>
                    <button id="copy-api-key-btn" class="btn secondary">Copier</button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn primary close-modal">Fermer</button>
            </div>
        </div>
    </div>

    <div class="modal" id="add-user-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Ajouter un nouvel utilisateur</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="add-user-form">
                    <div class="form-group">
                        <label for="new-username">Nom d'utilisateur</label>
                        <input type="text" id="new-username" required>
                    </div>
                    <div class="form-group">
                        <label for="new-email">Email</label>
                        <input type="email" id="new-email" required>
                    </div>
                    <div class="form-group">
                        <label for="new-password">Mot de passe</label>
                        <input type="password" id="new-password" required>
                    </div>
                    <div class="form-group">
                        <label for="new-user-role">Rôle</label>
                        <select id="new-user-role">
                            <option value="user">Utilisateur</option>
                            <option value="admin">Administrateur</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn secondary close-modal">Annuler</button>
                <button class="btn primary" id="save-new-user-btn">Ajouter</button>
            </div>
        </div>
    </div>

    <div class="modal" id="confirmation-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="confirmation-title">Confirmation</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <p id="confirmation-message">Êtes-vous sûr de vouloir effectuer cette action ?</p>
            </div>
            <div class="modal-footer">
                <button class="btn secondary close-modal">Annuler</button>
                <button class="btn danger" id="confirm-action-btn">Confirmer</button>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 FHIRHub - Convertisseur HL7 vers FHIR</p>
            <p>Version 1.0.0</p>
        </div>
    </footer>

    <script src="js/dashboard.js"></script>
</body>
</html>