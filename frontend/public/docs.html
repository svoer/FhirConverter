<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Documentation - FHIRHub</title>
  <link rel="stylesheet" href="css/styles.css">
  <style>
    .doc-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
    }
    
    .api-section {
      background-color: white;
      border-radius: 5px;
      padding: 1.5rem;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      margin-bottom: 2rem;
    }
    
    .api-endpoint {
      margin-bottom: 2rem;
      border-bottom: 1px solid var(--border-color);
      padding-bottom: 1rem;
    }
    
    .api-endpoint:last-child {
      border-bottom: none;
    }
    
    .api-route {
      display: inline-block;
      font-family: monospace;
      background-color: var(--secondary-color);
      padding: 0.25rem 0.5rem;
      border-radius: 3px;
      margin-right: 0.5rem;
    }
    
    .api-method {
      display: inline-block;
      font-weight: bold;
      padding: 0.25rem 0.5rem;
      border-radius: 3px;
      color: white;
    }
    
    .api-method.get {
      background-color: var(--accent-color);
    }
    
    .api-method.post {
      background-color: var(--success-color);
    }
    
    .api-method.put {
      background-color: var(--warning-color);
    }
    
    .api-method.delete {
      background-color: var(--error-color);
    }
    
    .api-description {
      margin: 1rem 0;
    }
    
    .api-params, .api-response {
      background-color: #f8f8f8;
      padding: 1rem;
      border-radius: 3px;
      margin: 1rem 0;
      overflow-x: auto;
      font-family: monospace;
      white-space: pre;
    }
    
    .api-example {
      margin-top: 1rem;
    }
    
    .api-example h4 {
      margin-bottom: 0.5rem;
    }
    
    .api-example-content {
      background-color: #2d2d2d;
      color: #f8f8f8;
      padding: 1rem;
      border-radius: 3px;
      overflow-x: auto;
      font-family: monospace;
      white-space: pre;
    }
    
    .navigation {
      position: sticky;
      top: 0;
      background-color: var(--background-color);
      padding: 1rem 0;
      margin-bottom: 2rem;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    
    .navigation ul {
      display: flex;
      list-style: none;
      gap: 1rem;
      overflow-x: auto;
      padding-bottom: 0.5rem;
    }
    
    .navigation a {
      color: var(--accent-color);
      text-decoration: none;
      padding: 0.5rem;
      border-radius: 3px;
      white-space: nowrap;
    }
    
    .navigation a:hover {
      background-color: var(--secondary-color);
    }
    
    .back-to-app {
      margin-bottom: 2rem;
    }
    
    .back-to-app a {
      display: inline-flex;
      align-items: center;
      color: var(--accent-color);
      text-decoration: none;
      font-weight: bold;
    }
    
    .back-to-app a:hover {
      text-decoration: underline;
    }
    
    .french-terms-section {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1rem;
      margin: 1rem 0;
    }
    
    .french-term {
      background-color: #f8f8f8;
      padding: 1rem;
      border-radius: 3px;
      border-left: 3px solid var(--accent-color);
    }
    
    .french-term-name {
      font-weight: bold;
      margin-bottom: 0.5rem;
    }
    
    .french-term-url {
      font-family: monospace;
      font-size: 0.9rem;
      word-break: break-all;
    }
    
    .french-term-oid {
      margin-top: 0.5rem;
      color: #666;
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">
      <h1>FHIR<span>Hub</span></h1>
    </div>
    <nav>
      <ul>
        <li><a href="/">Retour à l'application</a></li>
        <li><a href="#api-reference" class="active">Documentation API</a></li>
        <li><a href="#hl7-fhir">HL7 vers FHIR</a></li>
        <li><a href="#french-terminology">Terminologies françaises</a></li>
        <li><a href="https://www.hl7.org/fhir/R4/" target="_blank">Référence FHIR R4</a></li>
      </ul>
    </nav>
  </header>
  
  <div class="doc-container">
    <div class="back-to-app">
      <a href="/">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M19 12H5M12 19l-7-7 7-7"></path>
        </svg>
        Retour à l'application
      </a>
    </div>
    
    <h1>Documentation de FHIRHub</h1>
    <p>FHIRHub est un service de conversion de messages HL7 v2.5 vers FHIR R4, spécialement adapté au contexte français de la santé.</p>
    
    <div class="navigation">
      <ul>
        <li><a href="#api-reference">Référence API</a></li>
        <li><a href="#authentication">Authentification</a></li>
        <li><a href="#hl7-fhir">Conversion HL7 vers FHIR</a></li>
        <li><a href="#error-handling">Gestion des erreurs</a></li>
        <li><a href="#french-terminology">Terminologies françaises</a></li>
        <li><a href="#examples">Exemples</a></li>
      </ul>
    </div>
    
    <section id="api-reference">
      <h2>Référence API</h2>
      <p>FHIRHub expose une API RESTful qui permet d'interagir avec le service de conversion. Toutes les routes API commencent par le préfixe <code>/api</code>.</p>
      
      <div class="api-section">
        <h3>Statut du serveur</h3>
        
        <div class="api-endpoint">
          <h4>
            <span class="api-method get">GET</span>
            <span class="api-route">/api/health</span>
            Vérifier l'état du serveur
          </h4>
          
          <div class="api-description">
            <p>Cette route permet de vérifier si le serveur est en ligne et fonctionnel.</p>
          </div>
          
          <div class="api-params">
<strong>Paramètres de requête:</strong>
- apiKey (optionnel): Clé API pour l'authentification</div>
          
          <div class="api-response">
<strong>Réponse:</strong>
{
  "success": true,
  "status": "healthy",
  "version": "1.0.0",
  "timestamp": "2025-04-28T12:00:00.000Z"
}</div>
        </div>
      </div>
      
      <div class="api-section">
        <h3 id="authentication">Authentification</h3>
        <p>L'authentification se fait via une clé API qui doit être incluse dans toutes les requêtes API. La clé peut être passée de deux façons :</p>
        <ul>
          <li>En tant qu'en-tête <code>x-api-key</code></li>
          <li>En tant que paramètre de requête <code>apiKey</code></li>
        </ul>
        <p>En mode développement, l'authentification est automatiquement contournée pour faciliter les tests.</p>
      </div>
      
      <div class="api-section">
        <h3 id="hl7-fhir">Conversion HL7 vers FHIR</h3>
        
        <div class="api-endpoint">
          <h4>
            <span class="api-method post">POST</span>
            <span class="api-route">/api/convert</span>
            Convertir un message HL7 en FHIR
          </h4>
          
          <div class="api-description">
            <p>Cette route permet de convertir un message HL7 v2.5 en ressources FHIR R4.</p>
          </div>
          
          <div class="api-params">
<strong>Corps de la requête:</strong>
{
  "content": "MSH|^~\\&|SENDING_APP|SENDING_FACILITY|...",  // Message HL7 à convertir
  "options": {
    "validate": true,                                     // Valider les terminologies
    "french": true                                        // Adapter aux normes françaises
  }
}</div>
          
          <div class="api-response">
<strong>Réponse:</strong>
{
  "success": true,
  "message": "Conversion réussie",
  "processingTime": 150,                                  // Temps de traitement en ms
  "resourceCount": 5,                                     // Nombre de ressources générées
  "data": {
    "resourceType": "Bundle",
    "id": "bundle-uuid",
    "type": "transaction",
    "entry": [
      // Ressources FHIR...
    ]
  }
}</div>
          
          <div class="api-example">
            <h4>Exemple de requête avec curl</h4>
            <div class="api-example-content">curl -X POST "http://localhost:5000/api/convert?apiKey=dev-key" \
     -H "Content-Type: application/json" \
     -d '{"content":"MSH|^~\\&|SENDING_APP|SENDING_FACILITY|...", "options":{"validate":true, "french":true}}'</div>
          </div>
        </div>
      </div>
      
      <div class="api-section">
        <h3>Statistiques et historique</h3>
        
        <div class="api-endpoint">
          <h4>
            <span class="api-method get">GET</span>
            <span class="api-route">/api/stats</span>
            Obtenir les statistiques de conversion
          </h4>
          
          <div class="api-description">
            <p>Cette route permet d'obtenir des statistiques sur les conversions effectuées pour l'application associée à la clé API.</p>
          </div>
          
          <div class="api-params">
<strong>Paramètres de requête:</strong>
- apiKey (optionnel): Clé API pour l'authentification</div>
          
          <div class="api-response">
<strong>Réponse:</strong>
{
  "success": true,
  "data": {
    "total": 150,                                         // Nombre total de conversions
    "success": 145,                                       // Nombre de conversions réussies
    "error": 5,                                           // Nombre de conversions en erreur
    "avg_processing_time": 120,                           // Temps moyen de traitement en ms
    "last_conversion": "2025-04-28T12:00:00.000Z",        // Date de la dernière conversion
    "frequent_errors": [
      {
        "error_message": "Erreur de parsing HL7",
        "count": 3
      }
    ]
  }
}</div>
        </div>
        
        <div class="api-endpoint">
          <h4>
            <span class="api-method get">GET</span>
            <span class="api-route">/api/conversions</span>
            Obtenir l'historique des conversions
          </h4>
          
          <div class="api-description">
            <p>Cette route permet d'obtenir l'historique des conversions effectuées pour l'application associée à la clé API.</p>
          </div>
          
          <div class="api-params">
<strong>Paramètres de requête:</strong>
- apiKey (optionnel): Clé API pour l'authentification
- limit (optionnel): Nombre de résultats par page (défaut: 10)
- page (optionnel): Numéro de page (défaut: 1)</div>
          
          <div class="api-response">
<strong>Réponse:</strong>
{
  "success": true,
  "data": {
    "conversions": [
      {
        "id": 123,
        "source_type": "direct",
        "status": "success",
        "processing_time": 130,
        "created_at": "2025-04-28T12:00:00.000Z",
        "hl7_preview": "MSH|^~\\&|SENDING_APP|..."
      }
    ],
    "total": 150,
    "page": 1,
    "limit": 10,
    "pages": 15
  }
}</div>
        </div>
        
        <div class="api-endpoint">
          <h4>
            <span class="api-method get">GET</span>
            <span class="api-route">/api/conversions/:id</span>
            Obtenir les détails d'une conversion
          </h4>
          
          <div class="api-description">
            <p>Cette route permet d'obtenir les détails d'une conversion spécifique.</p>
          </div>
          
          <div class="api-params">
<strong>Paramètres de chemin:</strong>
- id: Identifiant de la conversion

<strong>Paramètres de requête:</strong>
- apiKey (optionnel): Clé API pour l'authentification</div>
          
          <div class="api-response">
<strong>Réponse:</strong>
{
  "success": true,
  "data": {
    "id": 123,
    "api_key_id": 1,
    "source_type": "direct",
    "hl7_content": "MSH|^~\\&|SENDING_APP|...",
    "fhir_content": "{\"resourceType\":\"Bundle\",...}",
    "status": "success",
    "processing_time": 130,
    "error_message": null,
    "created_at": "2025-04-28T12:00:00.000Z"
  }
}</div>
        </div>
      </div>
      
      <div class="api-section">
        <h3 id="error-handling">Gestion des erreurs</h3>
        <p>En cas d'erreur, l'API retournera une réponse avec un code d'état HTTP approprié et un corps JSON contenant des informations sur l'erreur.</p>
        
        <div class="api-response">
<strong>Exemple de réponse d'erreur:</strong>
{
  "success": false,
  "error": "Erreur de parsing HL7",
  "message": "Segment MSH non valide: champ 9 manquant"
}</div>
      </div>
      
      <div class="api-section">
        <h3 id="french-terminology">Terminologies françaises</h3>
        <p>FHIRHub prend en charge les terminologies françaises utilisées dans le domaine de la santé. Voici les principaux systèmes de terminologie supportés :</p>
        
        <div class="french-terms-section">
          <div class="french-term">
            <div class="french-term-name">CCAM</div>
            <div class="french-term-description">Classification Commune des Actes Médicaux</div>
            <div class="french-term-url">https://mos.esante.gouv.fr/NOS/CCAM_2/FHIR/CCAM</div>
            <div class="french-term-oid">OID: 1.2.250.1.213.2.5</div>
          </div>
          
          <div class="french-term">
            <div class="french-term-name">CIM-10</div>
            <div class="french-term-description">Classification Internationale des Maladies - 10ème révision</div>
            <div class="french-term-url">https://mos.esante.gouv.fr/NOS/CIM-10/FHIR/CIM-10</div>
            <div class="french-term-oid">OID: 1.2.250.1.213.2.4</div>
          </div>
          
          <div class="french-term">
            <div class="french-term-name">NABM</div>
            <div class="french-term-description">Nomenclature des Actes de Biologie Médicale</div>
            <div class="french-term-url">https://mos.esante.gouv.fr/NOS/NABM/FHIR/NABM</div>
            <div class="french-term-oid">OID: 1.2.250.1.213.1.1.5.5</div>
          </div>
          
          <div class="french-term">
            <div class="french-term-name">SNOMED 3.5</div>
            <div class="french-term-description">Systematized Nomenclature of Medicine - Version 3.5</div>
            <div class="french-term-url">https://mos.esante.gouv.fr/NOS/SNOMED_35/FHIR/SNOMED35</div>
            <div class="french-term-oid">OID: 1.2.250.1.213.2.12</div>
          </div>
          
          <div class="french-term">
            <div class="french-term-name">UCD</div>
            <div class="french-term-description">Unité Commune de Dispensation</div>
            <div class="french-term-url">https://mos.esante.gouv.fr/NOS/UCD/FHIR/UCD</div>
            <div class="french-term-oid">OID: 1.2.250.1.213.2.3.1</div>
          </div>
        </div>
        
        <p>Pour valider les terminologies françaises, FHIRHub utilise le Serveur Multi-Terminologies (SMT) de l'Agence du Numérique en Santé (ANS).</p>
      </div>
      
      <div class="api-section">
        <h3 id="examples">Exemples</h3>
        
        <div class="api-example">
          <h4>Conversion d'un ADT A01 (Admission)</h4>
          <div class="api-example-content">// Requête
POST /api/convert
Content-Type: application/json

{
  "content": "MSH|^~\\&|SENDING_APP|SENDING_FACILITY|RECEIVING_APP|RECEIVING_FACILITY|20230815131519||ADT^A01|MSG00001|P|2.5\rPID|1||12345^^^HIS^MR||DUPONT^JEAN||19751225|M|||29 RUE DE L'HOPITAL^^PARIS^^75013^FRA^H||0153927000|0612345678|||||72145^^^HOSP^NS\rPV1|1|I|CARD^301^1^HOSP^^^CARD|E|12345^^^HOSP^VN|||||MED||||||||V1234^^^EHR|||||||||||||||||||||||||20230815131519|",
  "options": {
    "validate": true,
    "french": true
  }
}

// Réponse
{
  "success": true,
  "message": "Conversion réussie",
  "processingTime": 120,
  "resourceCount": 3,
  "data": {
    "resourceType": "Bundle",
    "id": "bundle-12345",
    "type": "transaction",
    "entry": [
      {
        "fullUrl": "urn:uuid:msh-12345",
        "resource": {
          "resourceType": "MessageHeader",
          "id": "msh-12345",
          "eventCoding": {
            "system": "http://terminology.hl7.org/CodeSystem/v2-0003",
            "code": "ADT^A01",
            "display": "ADT Message"
          },
          "source": {
            "name": "SENDING_APP",
            "software": "FHIRHub Converter",
            "version": "1.0.0"
          },
          "timestamp": "2023-08-15T13:15:19Z"
        },
        "request": {
          "method": "POST",
          "url": "MessageHeader"
        }
      },
      {
        "fullUrl": "urn:uuid:patient-12345",
        "resource": {
          "resourceType": "Patient",
          "id": "patient-12345",
          "identifier": [
            {
              "system": "http://terminology.hl7.org/CodeSystem/v2-0203",
              "value": "12345",
              "type": {
                "coding": [
                  {
                    "system": "http://terminology.hl7.org/CodeSystem/v2-0203",
                    "code": "MR"
                  }
                ]
              }
            }
          ],
          "name": [
            {
              "family": "DUPONT",
              "given": ["JEAN"],
              "use": "official"
            }
          ],
          "gender": "male",
          "birthDate": "1975-12-25",
          "address": [
            {
              "line": ["29 RUE DE L'HOPITAL"],
              "city": "PARIS",
              "postalCode": "75013",
              "country": "FRA",
              "type": "physical"
            }
          ],
          "telecom": [
            {
              "system": "phone",
              "value": "0153927000",
              "use": "home"
            },
            {
              "system": "phone",
              "value": "0612345678",
              "use": "mobile"
            }
          ]
        },
        "request": {
          "method": "POST",
          "url": "Patient"
        }
      },
      {
        "fullUrl": "urn:uuid:encounter-12345",
        "resource": {
          "resourceType": "Encounter",
          "id": "encounter-12345",
          "status": "in-progress",
          "class": {
            "system": "http://terminology.hl7.org/CodeSystem/v3-ActCode",
            "code": "IMP"
          },
          "subject": {
            "reference": "urn:uuid:patient-12345"
          },
          "period": {
            "start": "2023-08-15T13:15:19Z"
          },
          "location": [
            {
              "location": {
                "display": "CARD 301"
              }
            }
          ]
        },
        "request": {
          "method": "POST",
          "url": "Encounter"
        }
      }
    ]
  }
}</div>
        </div>
      </div>
    </section>
  </div>
  
  <footer>
    <div class="copyright">
      © 2025 FHIRHub - Convertisseur HL7 v2.5 vers FHIR R4
    </div>
    <div class="version">
      Version 1.0.0
    </div>
  </footer>
</body>
</html>