[CONVERTER] Message HL7 parsé avec succès: 2 types de segments
[CONVERTER] Message HL7 parsé avec succès: 2 types de segments
[CONVERTER] Extraction des identifiants à partir de: ["458722781","","","CENTRE_HOSPITALIER_DE_TEST","PI"]
[CONVERTER] Traitement élément #0 du tableau
[CONVERTER] Extraction des identifiants à partir de: "458722781"
[CONVERTER] Traitement identifiant: 458722781 type: PI autorité: 
[CONVERTER] 1 identifiants extraits - INS: false, IPP: true
[CONVERTER] Traitement élément #1 du tableau
[CONVERTER] Extraction des identifiants à partir de: ""
[CONVERTER] Pas d'identifiants fournis
[CONVERTER] Traitement élément #2 du tableau
[CONVERTER] Extraction des identifiants à partir de: ""
[CONVERTER] Pas d'identifiants fournis
[CONVERTER] Traitement élément #3 du tableau
[CONVERTER] Extraction des identifiants à partir de: "CENTRE_HOSPITALIER_DE_TEST"
[CONVERTER] Traitement identifiant: CENTRE_HOSPITALIER_DE_TEST type: PI autorité: 
[CONVERTER] 1 identifiants extraits - INS: false, IPP: true
[CONVERTER] Traitement élément #4 du tableau
[CONVERTER] Extraction des identifiants à partir de: "PI"
[CONVERTER] Traitement identifiant: PI type: PI autorité: 
[CONVERTER] 1 identifiants extraits - INS: false, IPP: true
[CONVERTER] 3 identifiants extraits - INS: false, IPP: true
[CONVERTER] PID-13 (Home Phone): [["0123456789","PRN","CP"],["email@test.fr","NET","",""]]
[CONVERTER] PID-14 (Work Phone): ""
[CONVERTER] Extraction des télécom à partir de: [["0123456789","PRN","CP"],["email@test.fr","NET","",""]] ...
[CONVERTER] Télécom personnel (simple) ajouté: {"value":"0123456789","use":"home","system":"phone"}
[CONVERTER] Télécom personnel (simple) ajouté: {"value":"email@test.fr","use":"home","system":"phone"}
[CONVERTER] Numéro de téléphone invalide ignoré: email@test.fr
[CONVERTER] Total de télécom extraits: 1
[CONVERTER] Extraction des noms à partir de: ["SECLET","MARYSE BERTHE ALICE"]
[CONVERTER] Traitement des noms (tableau): ["SECLET","MARYSE BERTHE ALICE"]
[FRENCH_NAME_EXTRACTOR] Total de noms extraits: 1
[CONVERTER] Nom ajouté: {"use":"official","family":"SECLET"}
[FRENCH_NAME_EXTRACTOR] Nom avec plusieurs parties: MARYSE BERTHE ALICE
[FRENCH_NAME_EXTRACTOR] Total de noms extraits: 1
[CONVERTER] Nom ajouté: {"use":"official","family":"MARYSE","given":["BERTHE","ALICE"]}
[CONVERTER] Total noms extraits: 2
[CONVERTER] Gender field received: string F
[CONVERTER] Extraction des adresses à partir de: ["123 AVENUE DES HÔPITAUX","","PARIS","","75001","FRANCE","H"] ...
[CONVERTER] Adresse extraite (simple): {"use":"home","type":"both","line":["123 AVENUE DES HÔPITAUX"]}
[CONVERTER] Adresse extraite (simple): {"use":"home","type":"both","line":["PARIS"]}
[CONVERTER] Adresse extraite (simple): {"use":"home","type":"both","line":["75001"]}
[CONVERTER] Adresse extraite (simple): {"use":"home","type":"both","line":["FRANCE"]}
[CONVERTER] Adresse extraite (simple): {"use":"home","type":"both","line":["H"]}
[CONVERTER] Total d'adresses extraites: 5
[CONVERTER] Nom d'organisation semble être un horodatage: 20230801101530
[CONVERTER] Nom d'organisation remplacé par: Établissement destinataire
[CONVERTER] Aucun segment ROL trouvé dans le message
[CONVERTER] 0 ressources Encounter trouvées dans le bundle pour enrichissement
[CONVERTER] Conversion terminée avec 3 ressources FHIR générées
[CONVERTER] Conversion effectuée, temps: 8ms
[CACHE] Nouvelle entrée: 95943ff4... (total: 1)
[API] Conversion terminée en 9ms avec 3 ressources générées
[CONVERSION ERROR] SqliteError: table conversion_logs has no column named input_message
    at Database.prepare (/home/sv/FhirConverter/node_modules/better-sqlite3/lib/methods/wrappers.js:5:21)
    at processHL7Conversion (/home/sv/FhirConverter/app.js:430:8)
    at /home/sv/FhirConverter/app.js:477:10
    at Layer.handle [as handle_request] (/home/sv/FhirConverter/node_modules/express/lib/router/layer.js:95:5)
    at next (/home/sv/FhirConverter/node_modules/express/lib/router/route.js:149:13)
    at authCombinedMiddleware (/home/sv/FhirConverter/middleware/authCombined.js:105:7)
    at Layer.handle [as handle_request] (/home/sv/FhirConverter/node_modules/express/lib/router/layer.js:95:5)
    at next (/home/sv/FhirConverter/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/home/sv/FhirConverter/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/home/sv/FhirConverter/node_modules/express/lib/router/layer.js:95:5) {
  code: 'SQLITE_ERROR'
}
POST /api/convert 500 11.710 ms - 112

          SELECT ak.*, a.name as app_name
          FROM api_keys ak
          JOIN applications a ON ak.application_id = a.id
          WHERE ak.key = 'dev-key' AND ak.is_active = 1
        
SELECT created_by FROM applications WHERE id = 1.0
SELECT * FROM users WHERE id = 1.0
[AUTH] API Key associée à l'utilisateur admin (ID: 1)
[API] Démarrage de la conversion HL7 vers FHIR
[CACHE] Hit: 95943ff4... (1/2)
[CONVERTER] Utilisation du cache, temps: 0ms
[API] Conversion terminée en 0ms avec 3 ressources générées (depuis le cache)
[CONVERSION ERROR] SqliteError: table conversion_logs has no column named input_message
    at Database.prepare (/home/sv/FhirConverter/node_modules/better-sqlite3/lib/methods/wrappers.js:5:21)
    at processHL7Conversion (/home/sv/FhirConverter/app.js:430:8)
    at /home/sv/FhirConverter/app.js:477:10
    at Layer.handle [as handle_request] (/home/sv/FhirConverter/node_modules/express/lib/router/layer.js:95:5)
    at next (/home/sv/FhirConverter/node_modules/express/lib/router/route.js:149:13)
    at authCombinedMiddleware (/home/sv/FhirConverter/middleware/authCombined.js:105:7)
    at Layer.handle [as handle_request] (/home/sv/FhirConverter/node_modules/express/lib/router/layer.js:95:5)
    at next (/home/sv/FhirConverter/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/home/sv/FhirConverter/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/home/sv/FhirConverter/node_modules/express/lib/router/layer.js:95:5) {
  code: 'SQLITE_ERROR'
}
POST /api/convert 500 2.220 ms - 112

          SELECT ak.*, a.name as app_name
          FROM api_keys ak
          JOIN applications a ON ak.application_id = a.id
          WHERE ak.key = 'dev-key' AND ak.is_active = 1
        
SELECT created_by FROM applications WHERE id = 1.0
SELECT * FROM users WHERE id = 1.0
[AUTH] API Key associée à l'utilisateur admin (ID: 1)
[API] Démarrage de la conversion HL7 vers FHIR
[CACHE] Hit: 95943ff4... (2/3)
[CONVERTER] Utilisation du cache, temps: 0ms
[API] Conversion terminée en 0ms avec 3 ressources générées (depuis le cache)
[CONVERSION ERROR] SqliteError: table conversion_logs has no column named input_message
    at Database.prepare (/home/sv/FhirConverter/node_modules/better-sqlite3/lib/methods/wrappers.js:5:21)
    at processHL7Conversion (/home/sv/FhirConverter/app.js:430:8)
    at /home/sv/FhirConverter/app.js:477:10
    at Layer.handle [as handle_request] (/home/sv/FhirConverter/node_modules/express/lib/router/layer.js:95:5)
    at next (/home/sv/FhirConverter/node_modules/express/lib/router/route.js:149:13)
    at authCombinedMiddleware (/home/sv/FhirConverter/middleware/authCombined.js:105:7)
    at Layer.handle [as handle_request] (/home/sv/FhirConverter/node_modules/express/lib/router/layer.js:95:5)
    at next (/home/sv/FhirConverter/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/home/sv/FhirConverter/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/home/sv/FhirConverter/node_modules/express/lib/router/layer.js:95:5) {
  code: 'SQLITE_ERROR'
}
POST /api/convert 500 2.334 ms - 112

          SELECT ak.*, a.name as app_name
          FROM api_keys ak
          JOIN applications a ON ak.application_id = a.id
          WHERE ak.key = 'dev-key' AND ak.is_active = 1
        
SELECT created_by FROM applications WHERE id = 1.0
SELECT * FROM users WHERE id = 1.0
[AUTH] API Key associée à l'utilisateur admin (ID: 1)
[API] Démarrage de la conversion HL7 vers FHIR
[CACHE] Hit: 95943ff4... (3/4)
[CONVERTER] Utilisation du cache, temps: 0ms
[API] Conversion terminée en 0ms avec 3 ressources générées (depuis le cache)
[CONVERSION ERROR] SqliteError: table conversion_logs has no column named input_message
    at Database.prepare (/home/sv/FhirConverter/node_modules/better-sqlite3/lib/methods/wrappers.js:5:21)
    at processHL7Conversion (/home/sv/FhirConverter/app.js:430:8)
    at /home/sv/FhirConverter/app.js:477:10
    at Layer.handle [as handle_request] (/home/sv/FhirConverter/node_modules/express/lib/router/layer.js:95:5)
    at next (/home/sv/FhirConverter/node_modules/express/lib/router/route.js:149:13)
    at authCombinedMiddleware (/home/sv/FhirConverter/middleware/authCombined.js:105:7)
    at Layer.handle [as handle_request] (/home/sv/FhirConverter/node_modules/express/lib/router/layer.js:95:5)
    at next (/home/sv/FhirConverter/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/home/sv/FhirConverter/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/home/sv/FhirConverter/node_modules/express/lib/router/layer.js:95:5) {
  code: 'SQLITE_ERROR'
}
POST /api/convert 500 2.259 ms - 112
